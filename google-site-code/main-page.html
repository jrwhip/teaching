<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.1.1/math.min.js"></script>
    <!-- Link tag for the favicon with purple color -->
    <meta name="theme-color" content="#8A2BE2" />

    <style>
      span.frac {
        display: inline-block;
        text-align: center;
        vertical-align: middle;
      }

      span.frac > sup,
      span.frac > sub {
        display: block;
        font: inherit;
        font-size: 75%;
        padding: 0 0.3em;
        /* 7<span class="frac"><sup>42</sup><span>&frasl;</span><sub>73</sub></span> */
      }

      span.frac > sup {
        border-bottom: 0.08em solid;
      }

      span.frac > span {
        display: none;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 10px;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #87ceeb;
        /* Light grey background for the page */
      }

      :root {
  --menu-bg: #004d99;   /* initial navbar color */
  --menu-fg: #ffffff;   /* text/icons on menus */
}


      .correct {
        color: #009900;
      }

      .incorrect {
        color: red;
      }

      .small-font {
        font-size: 20px;
        /* Example size, adjust as needed */
      }

      .medium-font {
        font-size: 42px;
        /* Default or medium size, adjust as needed */
      }

      .large-font {
        font-size: 70px;
        /* Example size, adjust as needed */
      }

      .navbar {
  overflow: visible;
  background-color: var(--menu-bg);
  width: 100%;
}
      /* Make the navbar contain its floated children */
.navbar::after {
  content: "";
  display: table;
  clear: both;
}
      #headerContainer,
.content-wrapper,
#inputContainer {
  clear: both;
}


      .dropdown .dropbtn {
  font-size: 16px;
  border: none;
  outline: none;
  color: var(--menu-fg);
  padding: 14px 16px;
  background-color: transparent; /* or 'inherit' if you prefer */
  font-family: inherit;
  margin: 0;
  cursor: pointer;
}

      .dropdown {
  float: left;
  overflow: visible;        /* ensure the parent doesn't clip either */
  position: relative;
}

/* Submenu panel */
.dropdown-content {
  display: none;            /* stays hidden in the navbar */
}

/* Make submenu items vertical (stacked) and full-width */
.dropdown-content button {
  display: block;
  width: 100%;
  padding: 10px 16px;
  text-align: left;
  border: none;
  background: none;
  color: black;
  cursor: pointer;
}

/* Hover styles for submenu items */
.dropdown-content button:hover {
  background-color: #ddd;
}

/* Show submenu on hover of the parent */
.dropdown:hover .dropdown-content { /* disable hover opening */
  display: none !important;
}

/* --- APP LAYOUT: sidebar + main --- */
#appBody {
  display: flex;
  align-items: flex-start;
  gap: 20px;
  margin-top: 12px;
}

/* Left pinned submenu */
#leftSidebar {
  width: 150px;
  background: var(--menu-bg);  /* was #bebebe */
  border-radius: 10px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.15);
  padding: 8px 0;
  position: sticky;   /* stays in view on scroll */
  top: 8px;
  max-height: calc(100vh - 16px);
  overflow: auto;
}

/* Buttons inside the pinned panel */
#leftSidebar button {
  display: block;
  width: 100%;
  padding: 10px 16px;
  text-align: left;
  border: none;
  background: none;
  color: var(--menu-fg);        /* ensure readable on the menu bg */
  cursor: pointer;
}

#leftSidebar button:hover {
  background-color: rgba(255,255,255,0.15); /* subtle highlight on same bg */
}

/* Right content area (problems, shapes, inputs, etc.) */
#mainContent {
  flex: 1;
  min-width: 0;
}

/* Optional: show which top menu is active */
.navbar .dropdown.active > .dropbtn {
  background-color: rgba(255,255,255,0.12);
  border-bottom: 2px solid var(--menu-fg);
}

      #container {
        display: flex;
        flex-direction: column;
      }

      .font-sizer-container {
        display: flex;
        align-items: center;
        /* Align items vertically */
        margin-top: 10px;
        /* Adjust margin as needed */
      }

      #headerContainer {
        display: flex;
        align-items: center;
      }

      .text-size-label {
        margin-right: 10px;
        /* Adjust margin as needed */
      }

      .font-buttons {
        display: flex;
      }

      .arrow {
        font-size: 20px;
      }

      #counters {
        margin-right: 20px;
        /* Adjust margin as needed */
      }

      #fontSizer {
        display: flex;
      }

      .button-22 {
        width: 30px;
        /* Adjust width of buttons */
        height: 30px;
        /* Adjust height of buttons */
        margin-right: 10px;
        /* Adjust spacing between buttons */
        font-size: 14px;
        /* Adjust font size of labels */
        text-align: center;
        /* Center the text horizontally */
        line-height: 30px;
        /* Center the text vertically */
        border-radius: 10px;
        /* Add rounded corners */
        padding: 0;
        /* Remove default padding */
      }

      #problemContainer {
        margin-top: 12px;
        /* Adjust the value as needed */
        margin-bottom: 0px;
        /* Add margin below the problem container */
      }

      #inputContainer {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap; /* keeps it tidy on smaller screens */
  margin-top: 12px; /* space under the problem */
}

      #videoContainer {
        position: fixed; /* Ensure it overlays the content */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 700px;
        background-color: #000; /* Black background for better contrast */
        z-index: 1000; /* Ensure it stays above other content */
        border: 2px solid #fff;
        border-radius: 10px;
        padding: 10px;
        display: none; /* Hidden by default */
      }

      #videoContainer iframe {
        width: 100%;
        height: 400px;
        border: none;
      }

      #closeVideoButton {
        position: fixed;
        top: 10px;
        right: 10px;
        background-color: #ff0000;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1100;
      }

      #userAnswer {
        margin-right: 10px; /* Existing style */
        font-size: 24px; /* Increase this value to make the text bigger */
        padding: 5px; /* Optional: add some padding for better usability */
      }

      .video-button {
  display: inline-block;   /* was block */
  margin: 0;               /* remove extra margins */
}

      #hint {
        display: none;
        margin-top: 10px;
      }

      #previousAnswers {
        margin-top: 20px;
      }

      #fontSizer .button-22 {
        background-color: #888ac7;
        color: white;
        border: none;
        cursor: pointer;
        padding: 10px 10px;
        margin: 5px;
        display: flex;
        justify-content: center; /* Centers horizontally */
        align-items: center; /* Centers vertically */
      }

      #fontSizer .button-22:hover {
        background-color: #45a049;
        /* Darker green on hover for visual feedback */
      }

      .content-wrapper {
        display: flex;
        justify-content: start;
        align-items: flex-start;
        /* Align items at the start of the container */
        gap: 20px;
        /* Adjust gap as necessary */
      }

      #problemContainer {
        flex: 2; /* Increase this to make the problem container take more space */
        padding: 10px;
      }

      .question-trapezoid-wrapper {
        flex: 1; /* This will take less space compared to #problemContainer */
        padding: 10px;
      }

      .shape-container {
        position: relative;
        width: 20px;
        /* Adjust based on the trapezoid width */
        height: 50px;
        /* Adjust based on the trapezoid height plus space for labels */
      }

      .trapezoid {
        border-bottom: 100px solid #555;
        /* Thickness of trapezoid */
        border-left: 50px solid transparent;
        /* Left slant */
        border-right: 50px solid transparent;
        /* Right slant */
        width: 150px;
        /* Adjust width as needed */
        margin: 20px auto;
        /* Center the trapezoid horizontally */
      }

      .trapezoid-dimension {
        position: absolute;
        color: blue;
        font-size: 16px;
      }

      .top-dimension {
        position: absolute;
        top: 50px;
        /* Adjust as needed */
        left: 50%;
        /* Center relative to trapezoid width */
        transform: translateX(-50%);
      }

      .bottom-dimension {
        top: 200%;
        /* Adjust as needed */
        left: 50%;
        /* Center relative to trapezoid width */
        transform: translateX(-50%);
      }

      .height-dimension {
        left: 40px;
        /* Adjust as needed */
        top: 40px;
      }

      .question-trapezoid-wrapper {
        display: flex;
        flex-direction: row;
        /* Align children side by side */
        align-items: start;
        /* Align items at their start line */
        justify-content: space-around;
        /* Space out the children evenly */
      }

      #current-question,
      .shape-container {
        flex: 1;
        /* Allow both children to grow equally */
        padding: 10px;
        /* Add some padding around each child */
        box-sizing: border-box;
        /* Include padding and border in the element's total width and height */
      }

      .shape-container {
        display: none;
        /* Initially hidden */
      }

      .input-field {
        font-size: 24px; /* Adjust as needed */
        padding: 5px;
        margin-right: 10px; /* Space between inputs */
        width: 200px; /* Set a standard width */
        border: 2px solid #ccc;
        border-radius: 4px;
        flex: 0 1 auto;
      }
      #conditionalButtons {
        margin-top: 0px; /* Adds space above the entire button group */
      }

      #conditionalButtons button {
        background-color: #888ac7; /* Default background color */
        color: white; /* Default text color */
        border: none; /* Remove border */
        padding: 10px 20px; /* Add padding */
        font-size: 18px; /* Set font size */
        border-radius: 15px; /* Rounded corners increased */
        cursor: pointer; /* Pointer cursor on hover */
        transition:
          background-color 0.3s ease,
          transform 0.2s ease; /* Smooth hover effect */
        margin: 0 5px; /* Spacing between buttons */
      }

      #conditionalButtons button:hover {
        background-color: #45a049; /* Darker green on hover for visual feedback */
        transform: scale(1.1); /* Slight zoom effect */
      }

      #conditionalButtons button:active {
        transform: scale(1); /* Reset zoom */
      }

      /* Optional: Ensure space between rows of buttons if more are added */
      #conditionalButtons button + button {
        margin-top: 10px; /* Space between rows of buttons if stacked */
      }
    </style>
  </head>

  <body>
    <div class="navbar">
    
      <div class="dropdown">
        
        <button class="dropbtn">1.1</button>
        <div class="dropdown-content">
          
          
          
          
          
          <button onclick="generateAndDisplayProblem('impropertomixed')">
            1. Improper To Mixed
          </button>
          <button onclick="generateAndDisplayProblem('mixedtoimproper')">
            2. Mixed To Improper
          </button>
          <button onclick="generateAndDisplayProblem('rounding')">
            3 & 4. Round
          </button>
          
          <button onclick="generateAndDisplayProblem('dividefractions')">
            5. Divide
          </button>
          <button onclick="generateAndDisplayProblem('dividemixednumbers')">
            6. Divide Mixed
          </button>
          <button onclick="generateAndDisplayProblem('addsubtractmixed')">
            7. Add, Subtract fractions
          </button>
          <button onclick="generateAndDisplayProblem('fractiontodecimal')">
  8. Fraction → Decimal
</button>
<button onclick="generateAndDisplayProblem('decimaltofraction')">
  9. Decimal → Fraction
</button>


          <button onclick="generateAndDisplayProblem('addition')">
            
            10. Add
          </button>
          <button onclick="generateAndDisplayProblem('subtraction')">
            11. Subtract
          </button>
          <button onclick="generateAndDisplayProblem('factfamily')">
  12 & 13. Fact Family (× and ÷)
</button>

          
          
          <button onclick="generateAndDisplayProblem('multiplication')">
            14. Multiply
          </button>
          <button onclick="generateAndDisplayProblem('division')">
            15 & 16. Divide
          </button>

          <!-- More buttons can be added here -->
        </div>
      </div>
      <!-- Left sidebar where we render the clicked submenu -->
      <div class="dropdown">
        <button class="dropbtn">Basics</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('addition')">
            Add
          </button>
          <button onclick="generateAndDisplayProblem('subtraction')">
            Subtract
          </button>
          <button onclick="generateAndDisplayProblem('multiplication')">
            Multiply
          </button>
          <button onclick="generateAndDisplayProblem('division')">
            Divide
          </button>
          <button onclick="generateAndDisplayProblem('rounding')">
            Round
          </button>

          <!-- More buttons can be added here -->
        </div>
      </div>
      <!-- Left sidebar where we render the clicked submenu -->


      <!-- Ratios Dropdown Menu -->
      <div class="dropdown">
        <button class="dropbtn">Fractions</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('simplify')">
            Simplify
          </button>
          <button onclick="generateAndDisplayProblem('addsubtractmixed')">
            Add, Subtract
          </button>
          
          <button onclick="generateAndDisplayProblem('mixedtoimproper')">
            Mixed To Improper
          </button>
          <button onclick="generateAndDisplayProblem('impropertomixed')">
            Improper To Mixed
          </button>
          <button onclick="generateAndDisplayProblem('wholetimesmixed')">
            Whole Times Mixed
          </button>
          <button onclick="generateAndDisplayProblem('dividefractions')">
            Divide
          </button>
          <button onclick="generateAndDisplayProblem('dividemixednumbers')">
            Divide Mixed
          </button>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Compare</button>
        <div class="dropdown-content">
          
          <button onclick="generateAndDisplayProblem('comparefractions')">
            Fractions
          </button>
          <button onclick="generateAndDisplayProblem('comparison')">
            Decimals
          </button>
          <button onclick="generateAndDisplayProblem('compareintegers')">
            Integers
          </button>
          
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Percent</button>
        <div class="dropdown-content">
          
          <button onclick="generateAndDisplayProblem('convert')">
            Convert
          </button>
          <button onclick="generateAndDisplayProblem('percentofnumber')">
            Percent of Number
          </button>
          
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Ratios</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('ratio')">Ratio</button>
          <button onclick="generateAndDisplayProblem('solveratiotable')">
            Table
          </button>
          <button onclick="generateAndDisplayProblem('unitrate')">
            Unit Rate
          </button>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Equation</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('translation')">
            Translation
          </button>
          <button onclick="generateAndDisplayProblem('unknown')">
            Unknown
          </button>
          <button onclick="generateAndDisplayProblem('factor')">Factor</button>
          <button onclick="generateAndDisplayProblem('substitute')">
            Substitute
          </button>
          <button onclick="generateAndDisplayProblem('distribute')">
            Distribute
          </button>
          <button onclick="generateAndDisplayProblem('solveforx')">
            Solve For X
          </button>
          <button onclick="generateAndDisplayProblem('exponent')">
            Exponent
          </button>
          <button onclick="generateAndDisplayProblem('exponent2')">
            Exponent2
          </button>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Numbers</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('absolutevalue')">
            Absolute Value
          </button>
          <button onclick="generateAndDisplayProblem('opposites')">
            Opposites
          </button>
          <button onclick="generateAndDisplayProblem('lcm')">LCM</button>
          <button onclick="generateAndDisplayProblem('gcf')">GCF</button>
          
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Statistics</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('mean')">Mean</button>
          <button onclick="generateAndDisplayProblem('median')">Median</button>
          <button onclick="generateAndDisplayProblem('mode')">Mode</button>
          <button onclick="generateAndDisplayProblem('range')">Range</button>
          <button onclick="generateAndDisplayProblem('firstquartile')">
            First Quartile
          </button>
          <button onclick="generateAndDisplayProblem('thirdquartile')">
            Third Quartile
          </button>
          <button onclick="generateAndDisplayProblem('interquartilerange')">
            InterQuartileRange
          </button>
        </div>
      </div>
      
      <div class="dropdown">
        <button class="dropbtn">Reveal</button>
        <div class="dropdown-content">
          <button onclick="generateAndDisplayProblem('gcf')">GCF</button>
          <button onclick="generateAndDisplayProblem('distribute')">
            Distribute
          </button>
          <button onclick="generateAndDisplayProblem('wholetimesmixed')">
            Whole Times Mixed
          </button>
          <button onclick="generateAndDisplayProblem('solveforx')">
            Solve For X
          </button>
          <button onclick="generateAndDisplayProblem('substitute')">
            Substitute
          </button>
          <button onclick="generateAndDisplayProblem('addsubtractmixed')">
            Add Subtract Mixed
          </button>
          <button onclick="generateAndDisplayProblem('translation')">
            Translation
          </button>
          <button onclick="generateAndDisplayProblem('factor')">Factor</button>
          <button onclick="generateAndDisplayProblem('writeequation')">
            WriteEquation
          </button>
          <button onclick="generateAndDisplayProblem('trapezoid')">
            Trapezoid
          </button>
          <button onclick="generateAndDisplayProblem('triangle')">
            Triangle
          </button>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Color Theme</button>
        <div class="dropdown-content">
          <button onclick="changeBackgroundColor('#f5f5dc')">Beige</button>
          <button onclick="changeBackgroundColor('#d3d3d3')">Light Gray</button>
          <button onclick="changeBackgroundColor('#b6d0e2')">
            Powder Blue
          </button>
          <button onclick="changeBackgroundColor('#98ff98')">Mint Green</button>
          <button onclick="changeBackgroundColor('#36454f')">Charcoal</button>
          <button onclick="changeBackgroundColor('#ff7f50')">Coral</button>
          <button onclick="changeBackgroundColor('#008080')">Teal</button>
          <button onclick="changeBackgroundColor('#e2725b')">Terracotta</button>
          <button onclick="changeBackgroundColor('#e6e6fa')">Lavender</button>
          <button onclick="changeBackgroundColor('#87ceeb')">Sky Blue</button>
          <button onclick="changeBackgroundColor('#F8AD1E')">
            Golden Glow
          </button>
          <button onclick="changeBackgroundColor('#BA74EE')">Violet</button>
          <button onclick="changeBackgroundColor('#FF67B3')">Pink</button>
          <button onclick="changeBackgroundColor('#FFFFFF')">White</button>
          <button onclick="changeBackgroundColor('#0253B3')">Ocean Blue</button>
          <button onclick="changeBackgroundColor('#FFCB59')">
            Golden Yellow
          </button>
        </div>
      </div>
    </div>

    <div id="headerContainer">
      <div id="counters">
        Correct: <span id="correctCount">0</span><br />
        Incorrect: <span id="incorrectCount">0</span>
      </div>
      <div id="fontSizer">
        <div class="text-size-label"></div>
        <div class="font-buttons">
          <button id="smallFont" class="button-22">S</button>
          <button id="mediumFont" class="button-22">M</button>
          <button id="largeFont" class="button-22">L</button>
        </div>
      </div>
    </div>

    <div id="appBody">
  <!-- Left pinned submenu goes here -->
  <aside id="leftSidebar" aria-label="Pinned submenu"></aside>

  <!-- Everything else on the right -->
  <div id="mainContent">
  <div class="content-wrapper">
    <!-- RIGHT-SIDE: problem + (optional) trapezoid panel -->
    <div id="problemContainer"></div>

    <div class="question-trapezoid-wrapper">
      <div id="current-question"></div>
      <div class="shape-container">
        <div class="trapezoid">
          <div class="trapezoid-dimension top-dimension" id="top-dimension">Top: 100 units</div>
          <div class="trapezoid-dimension bottom-dimension" id="bottom-dimension">Bottom: 150 units</div>
          <div class="trapezoid-dimension height-dimension" id="height-dimension">Height: 120 units</div>
        </div>
      </div>
    </div>
  </div>

  <!-- controls under the problem (right column) -->
  <div id="inputContainer">
    <input
      type="text"
      id="userAnswer"
      class="input-field"
      placeholder="Enter your answer"
      autocomplete="off"
    />
    <input
      type="text"
      id="extraInput"
      class="input-field"
      placeholder="Additional input"
      autocomplete="off"
      style="display:none"
    />
    <button id="teachingVideoButton" class="video-button" style="display:none" onclick="changeVideo('')">
      Teaching
    </button>
    <button id="exampleVideoButton" class="video-button" style="display:none" onclick="changeVideo('')">
      Example
    </button>
    <button id="closeVideoButton" class="video-button" style="display:none" onclick="closeVideo()">
      Close Video
    </button>
  </div>

  <div id="conditionalButtons" style="display:none">
    <button type="button" id="lessThanButton" onclick="insertSymbol('<')"><</button>
    <button type="button" id="equalsButton" onclick="insertSymbol('=')">=</button>
    <button type="button" id="greaterThanButton" onclick="insertSymbol('>')">></button>
    <button type="button" id="trueButton" onclick="insertSymbol('T')">True</button>
    <button type="button" id="falseButton" onclick="insertSymbol('F')">False</button>
  </div>

  <div id="videoContainer" style="display:none"></div>
  <div id="hint" style="display:none"></div>
  <div id="previousAnswers"></div>
</div>


    
  </div>
</div>


    

    <script>
      class Problem {
        constructor(
          question,
          answer,
          validateFn,
          hint,
          needsExtraInput = false,
          teachingVideoId = null,
          exampleVideoId = null,
        ) {
          this.question = question
          this.answer = answer
          this.validate = validateFn
          this.hint = hint
          this.needsExtraInput = needsExtraInput
          this.teachingVideoId = teachingVideoId
          this.exampleVideoId = exampleVideoId
        }
      }

      let answersList = ""
      let correctAnswers = 0
      let incorrectAnswers = 0

      function updateCountersDisplay() {
        document.getElementById("correctCount").textContent = correctAnswers
        document.getElementById("incorrectCount").textContent = incorrectAnswers
      }

      function changeBackgroundColor(color) {
  // Page background
  document.body.style.backgroundColor = color;

  // Darken the color for button and menu backgrounds
  const darkenedColor = darkenColor(color, 0.6);

  // Decide a readable foreground (white or black) for menus
  const menuFg = getContrastYIQ(darkenedColor);

  // Apply to CSS variables so navbar + leftSidebar stay in sync
  document.documentElement.style.setProperty('--menu-bg', darkenedColor);
  document.documentElement.style.setProperty('--menu-fg', menuFg);

  // Recolor S/M/L and conditional buttons
  const buttons = document.querySelectorAll('.button-22');
  buttons.forEach((button) => {
    button.style.backgroundColor = darkenedColor;
    button.style.color = '#FFFFFF';
  });

  const conditionalButtons = document.querySelectorAll('#conditionalButtons button');
  conditionalButtons.forEach((button) => {
    button.style.backgroundColor = darkenedColor;
    button.style.color = '#FFFFFF';
  });

  // (Optional) If you still directly set navbar bg elsewhere, remove it now.
}


      // Helper function to darken the color
      function darkenColor(color, factor) {
        // Convert hex to RGB
        let r = parseInt(color.slice(1, 3), 16)
        let g = parseInt(color.slice(3, 5), 16)
        let b = parseInt(color.slice(5, 7), 16)

        // Apply the darkening factor
        r = Math.floor(r * factor)
        g = Math.floor(g * factor)
        b = Math.floor(b * factor)

        // Ensure the values are within the 0-255 range
        r = Math.max(0, Math.min(255, r))
        g = Math.max(0, Math.min(255, g))
        b = Math.max(0, Math.min(255, b))

        // Convert back to hex
        return `#${r.toString(16).padStart(2, "0")}${g
          .toString(16)
          .padStart(2, "0")}${b.toString(16).padStart(2, "0")}`
      }

      // Pick black or white text that best contrasts a hex bg
function getContrastYIQ(hex) {
  // hex like "#aabbcc"
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  const yiq = (r*299 + g*587 + b*114) / 1000;
  return yiq >= 128 ? '#000000' : '#FFFFFF';
}


      function pinMenuByDropdown(dropdownEl) {
    const panel = dropdownEl.querySelector('.dropdown-content');
    if (!panel) return;

    // Set active highlight on the top menu
    document.querySelectorAll('.navbar .dropdown').forEach(d => d.classList.remove('active'));
    dropdownEl.classList.add('active');

    // Move a clone of its submenu to the sidebar
    const sidebar = document.getElementById('leftSidebar');
    sidebar.innerHTML = '';                // clear old
    const clone = panel.cloneNode(true);   // keep existing onclick handlers
    clone.style.display = 'block';         // visible inside sidebar
    clone.id = 'pinnedPanel';
    sidebar.appendChild(clone);
  }

  // Set up click handlers on top-level menu buttons
  function initPinnedMenus() {
    const dropdowns = document.querySelectorAll('.navbar .dropdown');
    dropdowns.forEach(dd => {
      const btn = dd.querySelector('.dropbtn');
      if (!btn) return;
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        pinMenuByDropdown(dd);
      });
    });

    // Default: pin the first dropdown (or choose a specific one by text)
    const preferred =
      Array.from(dropdowns).find(dd => dd.querySelector('.dropbtn')?.textContent.trim() === 'Basics')
      || dropdowns[0];

    if (preferred) pinMenuByDropdown(preferred);
  }

  // Run once DOM is ready
  document.addEventListener('DOMContentLoaded', initPinnedMenus);

      function calculateGCF(a, b) {
        return b === 0 ? a : calculateGCF(b, a % b)
      }

      function calculateLCM(a, b) {
        const gcd = (x, y) => (!y ? x : gcd(y, x % y))
        return (a * b) / gcd(a, b)
      }

      const problemGenerators = {
   absolutevalue: { generate: generateAbsoluteValueProblem, },
   addition: { generate: generateAdditionProblem, },
   addsubtractmixed: { generate: generateAddSubtractMixedProblem, },
   comparefractions: { generate: generateCompareFractionsQuestion, },
   compareintegers: { generate: generateCompareIntegersProblem, },
   comparison: { generate: generateComparisonQuestion, },
   convert: { generate: generateConvertQuestion, },
   decimaltofraction: { generate: generateDecimalToFractionProblem },
   dividemixednumbers: { generate: generateDivideMixedNumbersProblem, },
   dividefractions: { generate: generateDivideFractionsProblem, },
   division: { generate: generateDivisionProblem, },
   distribute: { generate: generateDistributeProblem, },
   exponent: { generate: generateExponentProblem, },
   exponent2: { generate: generateExponent2Problem, },
   factor: { generate: generateFactorProblem, },
   factfamily: { generate: generateFactFamilyProblem },
   firstquartile: { generate: generateFirstQuartileProblem, },
   fractiontodecimal: { generate: generateFractionToDecimalProblem, },

   gcf: { generate: generateGCFProblem, },
   interquartilerange: { generate: generateInterquartileRangeProblem, },
   impropertomixed: { generate: generateImproperToMixedProblem, },
   lcm: { generate: generateLCMProblem, },
   mean: { generate: generateMeanProblem, },
   median: { generate: generateMedianProblem, },
   mixedtoimproper: { generate: generateMixedToImproperProblem, },
   mode: { generate: generateModeProblem, },
   multiplication: { generate: generateMultiplicationProblem, },
   opposites: { generate: generateOppositesProblem, },
   percentDecimal: { generate: generatePercentDecimalQuestion, },
   percentofnumber: { generate: generatePercentOfNumberProblem, },
   range: { generate: generateRangeProblem, },
   ratio: { generate: generateRatioProblem, },
   rounding: { generate: generateRoundingProblem, },
   simplify: { generate: generateSimplifyProblem, },
   solveforx: { generate: generateSolveForXProblem, },
   solveratiotable: { generate: generateSolveRatioTableProblem, },
   substitute: { generate: generateSubstituteProblem, },
   subtraction: { generate: generateSubtractionProblem, },
   thirdquartile: { generate: generateThirdQuartileProblem, },
   trapezoid: { generate: generateTrapezoidProblem, },
   translation: { generate: generateTranslationProblem, },
   triangle: { generate: generateTriangleProblem, },
   unitrate: { generate: generateUnitRateProblem, },
   unknown: { generate: generateUnknownProblem, },
   wholetimesmixed: { generate: generateWholeTimesMixedProblem, },
   writeequation: { generate: generateWriteEquationProblem, },
};


      //Basicsmenu//
      function generateAdditionProblem() {
        // Generate random decimal places between 0 and 3 for both numbers
        const decimalPlacesNum1 = Math.floor(Math.random() * 4)
        const decimalPlacesNum2 = Math.floor(Math.random() * 4)

        // Generate random decimal numbers between 0.003 and 900 for num1 and 0.003 and 90 for num2
        let num1 = (Math.random() * (900 - 0.003) + 0.003).toFixed(
          decimalPlacesNum1,
        )
        let num2 = (Math.random() * (90 - 0.003) + 0.003).toFixed(
          decimalPlacesNum2,
        )

        // Ensure both numbers have a decimal point for consistent processing
        num1 += num1.includes(".") ? "" : "."
        num2 += num2.includes(".") ? "" : "."

        // Calculate the sum and format it
        // Calculate the sum and format it with maximum decimal precision from both numbers
        const maxDecimalPlaces = Math.max(decimalPlacesNum1, decimalPlacesNum2)
        const sum = parseFloat(
          (parseFloat(num1) + parseFloat(num2)).toFixed(maxDecimalPlaces),
        )
        const num1Padded = num1.padEnd(
          num1.indexOf(".") + 1 + maxDecimalPlaces,
          "0",
        )
        const num2Padded = num2.padEnd(
          num2.indexOf(".") + 1 + maxDecimalPlaces,
          "0",
        )
        const sumPadded = sum.toFixed(maxDecimalPlaces)

        // Extract digits function encapsulated within the main function
        function extractDigits(num, maxDecimals) {
          const parts = num.split(".")
          const integerPart = parts[0]
          const decimalPart = parts.length > 1 ? parts[1] : ""

          return {
            hundreds:
              integerPart.length > 2
                ? integerPart[integerPart.length - 3]
                : " ",
            tens:
              integerPart.length > 1
                ? integerPart[integerPart.length - 2]
                : " ",
            ones:
              integerPart.length > 0
                ? integerPart[integerPart.length - 1]
                : " ",
            tenths:
              decimalPart.length > 0 && maxDecimals >= 1 ? decimalPart[0] : " ",
            hundredths:
              decimalPart.length > 1 && maxDecimals >= 2 ? decimalPart[1] : " ",
            thousandths:
              decimalPart.length > 2 && maxDecimals >= 3 ? decimalPart[2] : " ",
          }
        }

        // Constructing the hint
        const digitsNum1 = extractDigits(num1, maxDecimalPlaces)
        const digitsNum2 = extractDigits(num2, maxDecimalPlaces)
        const digitsSum = extractDigits(
          sum.toFixed(maxDecimalPlaces),
          maxDecimalPlaces,
        )

        function calculateCarry(a, b, c) {
          a = a.trim() === "" ? 0 : parseInt(a)
          b = b.trim() === "" ? 0 : parseInt(b)
          c = c.trim() === "" ? 0 : parseInt(c)
          let carry = Math.floor((a + b + c) / 10)
          return carry > 0 ? carry.toString() : "" // Return the carry as a string or an empty string if zero
        }

        let carry = {
          thousandths: "",
          hundredths: "",
          tenths: "",
          ones: "",
          tens: "",
          hundreds: "",
        }

        // Example carry calculation corrections applied below:
        carry.thousandths = calculateCarry(
          digitsNum1.thousandths,
          digitsNum2.thousandths,
          "",
        )
        carry.hundredths = calculateCarry(
          digitsNum1.hundredths,
          digitsNum2.hundredths,
          carry.thousandths.toString(),
        )
        carry.tenths = calculateCarry(
          digitsNum1.tenths,
          digitsNum2.tenths,
          carry.hundredths.toString(),
        )
        carry.ones = calculateCarry(
          digitsNum1.ones,
          digitsNum2.ones,
          carry.tenths.toString(),
        )
        carry.tens = calculateCarry(
          digitsNum1.tens,
          digitsNum2.tens,
          carry.ones.toString(),
        )
        carry.hundreds = calculateCarry(
          digitsNum1.hundreds,
          digitsNum2.hundreds,
          carry.tens.toString(),
        )

        let hint = `Add them step by step:<br>

1. Write the numbers vertically, aligning the decimal points:
<br>2. If a column's total is 10 or more, carry over to the next column.<br>
3. Write down the sum with the decimal point aligned 
<br><br><table style="border-collapse: collapse;">
        
       <tr>
        
        <td style="color: red;">${carry.hundreds}</td>
        <td style="color: red;">${carry.tens}</td>
        <td style="color: red;">${carry.ones}</td>
        <td style="color: red;">${carry.tenths}</td>
        <td></td>
        <td style="color: red;">${carry.hundredths}</td>
        <td style="color: red;">${carry.thousandths}</td>

        
        <td></td>
    </tr>
        <tr>
            <td></td>
            <td>${digitsNum1.hundreds}</td>
            <td>${digitsNum1.tens}</td>
            <td>${digitsNum1.ones}</td>
            <td>.</td>
            <td>${digitsNum1.tenths}</td>
            <td>${digitsNum1.hundredths}</td>
            <td>${digitsNum1.thousandths}</td>
            
        </tr>
        <tr style="border-bottom: 2px solid black;">
            <td>+</td>
            <td>${digitsNum2.hundreds}</td>
            <td>${digitsNum2.tens}</td>
            <td>${digitsNum2.ones}</td>
            <td>.</td>
            <td>${digitsNum2.tenths}</td>
            <td>${digitsNum2.hundredths}</td>
            <td>${digitsNum2.thousandths}</td>
        </tr>
        <tr>
            <td></td>
            <td>${digitsSum.hundreds}</td>
            <td>${digitsSum.tens}</td>
            <td>${digitsSum.ones}</td>
            <td>.</td>
            <td>${digitsSum.tenths}</td>
            <td>${digitsSum.hundredths}</td>
            <td>${digitsSum.thousandths}</td>
        </tr>
    </table>
      
`

        // Define the validate function
        const validateFn = (userInput) => {
          const isCorrect = parseFloat(userInput) === sum
          displayHintAndFeedback(isCorrect, hint)
          return isCorrect
        }

        // Return a new Problem object with the question, answer, and validate function
        return new Problem(
          `${num1} + ${num2}`,
          sum,
          validateFn,
          hint,
          false, // No additional input needed for this problem
          "WwKLA-6S-e0", // Teaching video ID
          "1xXibPhF3bw", // Example video ID
        )
      }

      function generateFactFamilyProblem() {
  // Factors 1–12 (classic math facts)
  const a = Math.floor(Math.random() * 12) + 1; // D18
  const b = Math.floor(Math.random() * 12) + 1; // E18
  const c = a * b;

  // Choose format 1..12 (your IF-chain covers 1..11 plus an "else" pattern)
  const format = Math.floor(Math.random() * 12) + 1;

  // Build question text with a single blank and compute the missing value
  let questionText = "";
  let answerValue;

  switch (format) {
    case 1:  // D18 x E18 = _____
      questionText = `${a} x ${b} = _______`;
      answerValue = c;
      break;
    case 2:  // D18 x _____ = D18*E18
      questionText = `${a} x _______ = ${c}`;
      answerValue = b;
      break;
    case 3:  // _____ x D18 = D18*E18
      questionText = `_______ x ${a} = ${c}`;
      answerValue = b;
      break;
    case 4:  // D18*E18 ÷ D18 = _____
      questionText = `${c} ÷ ${a} = _______`;
      answerValue = b;
      break;
    case 5:  // D18*E18 ÷ _____ = D18
      questionText = `${c} ÷ _______ = ${a}`;
      answerValue = b;
      break;
    case 6:  // _____ ÷ D18 = E18
      questionText = `_______ ÷ ${a} = ${b}`;
      answerValue = c;
      break;
    case 7:  // _____ = D18 x E18
      questionText = `_______ = ${a} x ${b}`;
      answerValue = c;
      break;
    case 8:  // D18*E18 = D18 x _____
      questionText = `${c} = ${a} x _______`;
      answerValue = b;
      break;
    case 9:  // D18*E18 = _____ x D18
      questionText = `${c} = _______ x ${a}`;
      answerValue = b;
      break;
    case 10: // _____ = D18*E18 ÷ D18
      questionText = `_______ = ${c} ÷ ${a}`;
      answerValue = b;
      break;
    case 11: // D18 = D18*E18 ÷ _____
      questionText = `${a} = ${c} ÷ _______`;
      answerValue = b;
      break;
    default: // (12) D18 = ______ ÷ E18
      questionText = `${a} = _______ ÷ ${b}`;
      answerValue = c;
      break;
  }

  // Friendly hint showing the whole fact family
  const hint = `
    <table border="1" cellpadding="6" style="border-collapse:collapse">
      <tr><th>Fact Family</th></tr>
      <tr><td>${a} × ${b} = ${c}</td></tr>
      <tr><td>${b} × ${a} = ${c}</td></tr>
      <tr><td>${c} ÷ ${a} = ${b}</td></tr>
      <tr><td>${c} ÷ ${b} = ${a}</td></tr>
    </table>
    <br>Fill in the blank with the single missing number.
  `;

  // Validator: single numeric answer
  const validateFn = (userInput) => {
    const n = Number(userInput);
    const isCorrect = !Number.isNaN(n) && n === answerValue;
    displayHintAndFeedback(isCorrect, hint);
    return isCorrect;
  };

  return new Problem(
    questionText,
    String(answerValue),   // canonical answer
    validateFn,
    hint,
    false,
    "", // teaching video ID (optional)
    ""  // example video ID (optional)
  );
}

      function generateSubtractionProblem() {
        let num1, num2
        let decimalPlacesNum1, decimalPlacesNum2

        do {
          // Generate random decimal places between 0 and 3 for both numbers
          decimalPlacesNum1 = Math.floor(Math.random() * 4)
          decimalPlacesNum2 = Math.floor(Math.random() * 4)

          // Generate random decimal numbers between 0.003 and 900 for num1 and 0.003 and 90 for num2
          num1 = (Math.random() * (900 - 0.003) + 0.003).toFixed(
            decimalPlacesNum1,
          )
          num2 = (Math.random() * (90 - 0.003) + 0.003).toFixed(
            decimalPlacesNum2,
          )

          // Convert the numbers to floats to ensure num1 is larger than num2
          num1 = parseFloat(num1)
          num2 = parseFloat(num2)
        } while (num1 < num2)

        // Calculate the maximum decimal places present in both numbers
        const maxDecimalPlaces = Math.max(decimalPlacesNum1, decimalPlacesNum2)

        // Calculate the difference and format it
        const difference = parseFloat((num1 - num2).toFixed(maxDecimalPlaces))

        // Pad the numbers for alignment
        const num1Padded = num1.toFixed(maxDecimalPlaces)
        const num2Padded = num2.toFixed(maxDecimalPlaces)
        const differencePadded = difference.toFixed(maxDecimalPlaces)

        // Function to extract digits for alignment
        function extractDigits(num, maxDecimals) {
          const parts = num.toString().split(".")
          const integerPart = parts[0]
          const decimalPart = parts.length > 1 ? parts[1] : ""

          return {
            hundreds:
              integerPart.length > 2
                ? integerPart[integerPart.length - 3]
                : " ",
            tens:
              integerPart.length > 1
                ? integerPart[integerPart.length - 2]
                : " ",
            ones:
              integerPart.length > 0
                ? integerPart[integerPart.length - 1]
                : " ",
            tenths:
              decimalPart.length > 0 && maxDecimals >= 1 ? decimalPart[0] : " ",
            hundredths:
              decimalPart.length > 1 && maxDecimals >= 2 ? decimalPart[1] : " ",
            thousandths:
              decimalPart.length > 2 && maxDecimals >= 3 ? decimalPart[2] : " ",
          }
        }

        // Constructing the hint with vertical alignment and borrowing visualization
        let hint = `Let's subtract them step by step:<br>
    1. Write the numbers vertically, aligning the decimal points.<br>
    2. Subtract each column from right to left.<br>
    3. Write down the difference with the decimal point aligned.<br><br>
    <table style="border-collapse: collapse; text-align: right;">
        <tr>
            <td> </td>
            <td>${extractDigits(num1Padded, maxDecimalPlaces).hundreds}</td>
            <td>${extractDigits(num1Padded, maxDecimalPlaces).tens}</td>
            <td>${extractDigits(num1Padded, maxDecimalPlaces).ones}</td>
            <td>.</td>
            <td>${extractDigits(num1Padded, maxDecimalPlaces).tenths}</td>
            <td>${extractDigits(num1Padded, maxDecimalPlaces).hundredths}</td>
            <td>${extractDigits(num1Padded, maxDecimalPlaces).thousandths}</td>
        </tr>
        <tr style="border-bottom: 2px solid black;">
            <td>-</td>
            <td>${extractDigits(num2Padded, maxDecimalPlaces).hundreds}</td>
            <td>${extractDigits(num2Padded, maxDecimalPlaces).tens}</td>
            <td>${extractDigits(num2Padded, maxDecimalPlaces).ones}</td>
            <td>.</td>
            <td>${extractDigits(num2Padded, maxDecimalPlaces).tenths}</td>
            <td>${extractDigits(num2Padded, maxDecimalPlaces).hundredths}</td>
            <td>${extractDigits(num2Padded, maxDecimalPlaces).thousandths}</td>
        </tr>
        <tr>
            <td> </td>
            <td>${extractDigits(differencePadded, maxDecimalPlaces).hundreds}</td>
            <td>${extractDigits(differencePadded, maxDecimalPlaces).tens}</td>
            <td>${extractDigits(differencePadded, maxDecimalPlaces).ones}</td>
            <td>.</td>
            <td>${extractDigits(differencePadded, maxDecimalPlaces).tenths}</td>
            <td>${extractDigits(differencePadded, maxDecimalPlaces).hundredths}</td>
            <td>${extractDigits(differencePadded, maxDecimalPlaces).thousandths}</td>
        </tr>
    </table>`

        // Define the validate function
        const validateFn = (userInput) => {
          const isCorrect = parseFloat(userInput) === difference
          displayHintAndFeedback(isCorrect, hint)
          return isCorrect
        }

        // Return a new Problem object with the question, answer, and validate function
        return new Problem(
          `${num1} - ${num2}`,
          difference,
          validateFn,
          hint,
          false,
          "a8tCGNB-vOk",
          "w6LfGwslhlw",
        )
      }
      function generateMultiplicationProblem() {
        const num1 = Math.floor(Math.random() * 80) + 15
        const num2 = Math.floor(Math.random() * 80) + 15
        const onesPlaceNum1 = num1 % 10 // Digit in the ones place of num2
        const onesPlaceNum2 = num2 % 10 // Digit in the ones place of num2
        const tensPlaceNum2 = Math.floor(num2 / 10) % 10 // Digit in the tens place of num2
        const multiplicationStep1 = num1 * onesPlaceNum2
        const multiplicationStep2 = num1 * tensPlaceNum2

        const onesPlaceProduct = onesPlaceNum1 * onesPlaceNum2
        const tensDigitOfOnesPlaceProduct =
          onesPlaceProduct >= 10 ? Math.floor((onesPlaceProduct / 10) % 10) : ""

        const tensPlaceProduct = onesPlaceNum1 * tensPlaceNum2
        const tensDigitOfTensPlaceProduct =
          tensPlaceProduct >= 10 ? Math.floor((tensPlaceProduct / 10) % 10) : ""

        // Hint construction with visual representation in a table format
        const hint = `Let's break down the multiplication: <br>
    Given: ${num1} × ${num2}<br><br>
    <style>
        .blue { color: blue; }
        .bright-blue { color: #8800eb; }
        .dark-blue { color: #00008B; }
        .dark-green { color: #006400; }
        .red { color: red; }
        .black { color: black; }
    </style>
    <table style="border-collapse: collapse;">
      <tr>
        <th style="text-align: right;">Times the <br>ones place</th>
         <td style="text-align: right;">&nbsp;</td>
        <th style="text-align: right;">Times the <br>tens place</th>
         <td style="text-align: right;">&nbsp;</td>
        <th style="text-align: right;">Add the <br>Products</th>
      </tr>
      <tr>
        <td class="blue" style="text-align: right;"></td>
        <td style="text-align: right;">&nbsp;</td>
        <td class="red" style="text-align: right;"></td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="red" style="text-align: right;">${tensDigitOfTensPlaceProduct}&nbsp;&nbsp;</td>
      </tr>
      <tr>
        <td class="bright-blue" style="text-align: right;">${tensDigitOfOnesPlaceProduct}&nbsp;&nbsp;</td>
        <td style="text-align: right;">&nbsp;</td>
        <td class="red" style="text-align: right;">${tensDigitOfTensPlaceProduct}&nbsp;&nbsp;</td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="blue" style="text-align: right;">${tensDigitOfOnesPlaceProduct}&nbsp;&nbsp;</td>
      </tr>
      <tr>
        <td class="black" style="text-align: right;">${num1}</td>
        <td style="text-align: right;">&nbsp;</td>
        <td class="black" style="text-align: right;">${num1}</td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="black" style="text-align: right;">${num1}</td>
      </tr>
      <tr>
        <td class="blue" style="text-align: right; border-bottom: 1px solid black;">× <span class="blue">${onesPlaceNum2}</span></td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="red" style="text-align: right; border-bottom: 1px solid black;">× <span class="red">${tensPlaceNum2}0</span></td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="black" style="text-align: right; border-bottom: 1px solid black;">× <span class="red">${tensPlaceNum2}</span><span class="blue">${onesPlaceNum2}</span></td>
      </tr>
      <tr>
        <td class="blue" style="text-align: right;">${multiplicationStep1}</td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="red" style="text-align: right;">${multiplicationStep2 * 10}</td>
         <td style="text-align: right;">&nbsp;</td>
        <td class="blue" style="text-align: right;">${multiplicationStep1}</td>
      </tr>
      <tr>
        <td style="text-align: right;">&nbsp;</td>
        <td style="text-align: right;">&nbsp;</td>
        <td style="text-align: right;">&nbsp;</td>
        <td style="text-align: right;">&nbsp;</td>
        <td class="red" style="text-align: right; border-bottom: 1px solid black;">+ ${multiplicationStep2 * 10}</td>
      </tr>
      <tr>
        <td style="text-align: right;">&nbsp;</td>
         <td style="text-align: right;">&nbsp;</td>
         <td style="text-align: right;">&nbsp;</td>
        <td style="text-align: right;">&nbsp;</td>
        <td class="black" style="text-align: right;">${multiplicationStep1 + multiplicationStep2 * 10}</td>
      </tr>
    </table>`

        const product = num1 * num2

        const validateFn = (userInput) => {
          const isCorrect = parseFloat(userInput) === product
          displayHintAndFeedback(isCorrect, hint)
          return isCorrect
        }

        return new Problem(
          `${num1} × ${num2}`,
          product,
          validateFn,
          hint,
          false, // No additional input needed for this problem
          "PZjIT9CH6bM", // Teaching video ID
          "hV3RstrYGEA", // Example video ID
        )
      }
      function generateDivisionProblem() {
        let num1 = Math.floor(Math.random() * 899) + 100 // Random number between 100 and 998
        let num2 = Math.floor(Math.random() * 14) + 5 // Random number between 5 and 18

        // Randomly decide to round to the nearest tenth or hundredth
        let roundingType = Math.floor(Math.random() * 2) // 0 for tenth, 1 for hundredth
        let answer
        let roundingInstruction

        if (roundingType === 0) {
          // Round to the nearest tenth
          answer = parseFloat((num1 / num2).toFixed(1))
          roundingInstruction = "Round your answer to the nearest tenth."
        } else {
          // Round to the nearest hundredth
          answer = parseFloat((num1 / num2).toFixed(2))
          roundingInstruction = "Round your answer to the nearest hundredth."
        }

        const question = `What is ${num1} divided by ${num2}? ${roundingInstruction}`
        // Calculate the whole number part of the division
        const wholeNumberPart = Math.floor(num1 / num2)

        // Calculate the fractional part of the division
        const fractionalPart = num1 / num2 - wholeNumberPart

        // Determine the rounding precision based on the rounding type
        const roundingPrecision = roundingType === 0 ? 1 : 2

        // Round the fractional part to the correct precision
        const roundedFractionalPart = parseFloat(
          fractionalPart.toFixed(roundingPrecision),
        )

        // Convert the fractional part to a string without a leading zero
        const fractionalString =
          roundedFractionalPart === 0
            ? ""
            : roundedFractionalPart.toString().slice(1)

        const hint = `
    <table style="border-collapse: collapse;">
        <tr>
            <td style="text-align: right;">&nbsp;</td>
            <td style="text-align: right;">${wholeNumberPart}</td>
            <td style="text-align: left;">${fractionalString}</td>
                
                
                
            </tr>
            <tr>
                <td style="border-right: 1px solid black;">${num2}</td>
                <td style="border-top: 1px solid black;">${num1}</td>
                
               
            </tr>
            <tr>
                
        </table>
       <br> ${roundingInstruction}
    `

        // Adjust the validateFn to properly handle both correct and incorrect answers
        const validateFn = (userInput) => {
          const parsedInput = parseFloat(userInput)
          const comparisonPrecision = roundingType === 0 ? 1 : 2 // Determine the precision based on the rounding type
          const isCorrect =
            parsedInput.toFixed(comparisonPrecision) ==
            answer.toFixed(comparisonPrecision)

          // Call displayHintAndFeedback for both correct and incorrect answers to update UI and counters accordingly
          displayHintAndFeedback(isCorrect, hint)

          return isCorrect
        }

        return new Problem(
          question,
          answer.toString(),
          validateFn,
          hint,
          false,
          "ITpzAicMmqo",
          "rXjV74suB68",
        )
      }
      function generateRoundingProblem() {
    const roundTypes = [
        "tens",
        "hundreds",
        "thousands",
        "tenths",
        "hundredths",
    ];
    const roundType =
        roundTypes[Math.floor(Math.random() * roundTypes.length)];

    let num;

    if (
        roundType === "hundreds" ||
        roundType === "thousands" ||
        roundType === "tens"
    ) {
        num = Math.floor(Math.random() * 9000) + 1000; // Numbers between 1000 and 9999
    } else {
        let decimalPlaces = roundType === "tenths" ? 2 : 3; // Decide on decimal places based on the rounding type
        num = +(Math.random() * 10).toFixed(decimalPlaces);
    }

    const numStr = num.toString();
    let placeValueDigit = "";
    let nextDigit = "";
    let roundingPosition;

    switch (roundType) {
        case "tens":
            roundingPosition = numStr.indexOf(".") >= 0 ? numStr.indexOf(".") - 1 : numStr.length - 2;
            break;
        case "hundreds":
            roundingPosition = numStr.indexOf(".") >= 0 ? numStr.indexOf(".") - 2 : numStr.length - 3;
            break;
        case "thousands":
            roundingPosition = numStr.indexOf(".") >= 0 ? numStr.indexOf(".") - 3 : numStr.length - 4;
            break;
        case "tenths":
            roundingPosition = numStr.indexOf(".") + 1;
            break;
        case "hundredths":
            roundingPosition = numStr.indexOf(".") + 2;
            break;
    }

    if (roundingPosition >= 0 && roundingPosition < numStr.length) {
        placeValueDigit = numStr[roundingPosition];
        nextDigit =
            roundingPosition + 1 < numStr.length
                ? numStr[roundingPosition + 1]
                : "0";
    }

    const roundedNum = roundNumber(num, roundType).toString();
    const numStrhint = num.toString();
    const question = `Round ${num} to the nearest ${roundType}`;

    let hint = "";

    if (numStrhint === roundedNum) {
        hint = `There are no digits smaller than the ${roundType} place (${placeValueDigit}) in the number ${num}.<br> The number stays the same`;
    } else {
        hint = `To round ${num} to the nearest ${roundType}: <br><br>
        <table border="1" cellpadding="5">
            <tr>
                <td colspan="2">Step</td>
                <td>Explanation</td>
            </tr>
            <tr>
                <td>1</td>
                <td>
                    ${numStr.slice(0, roundingPosition)}<span style="border: 1px solid black; padding: 3px;">${numStr[roundingPosition] || ''}</span><u style="color: red;">${numStr.slice(roundingPosition + 1, roundingPosition + 2) || ''}</u>${numStr.slice(roundingPosition + 2)}
                </td>
                <td>
                    Circle the digit in the ${roundType} place and underline the next digit to the right.
                </td>
            </tr>
            <tr>
                <td>2</td>
                <td>
                    ${numStr.slice(0, roundingPosition)}<span style="border: 1px solid black; padding: 3px;">${numStr[roundingPosition] || ''}</span><u style="color: red;">${numStr.slice(roundingPosition + 1, roundingPosition + 2) || ''}</u>${numStr.slice(roundingPosition + 2)} ≈ ${roundedNum}
                </td>
                <td>
                    ${nextDigit ? `With ${nextDigit} to the right, ` : "No digit to the right, "}${
            nextDigit
                ? nextDigit >= "5"
                    ? `we round up.`
                    : `we round down.`
                : `The number is already at the correct place; it doesn't change.`
        }
                </td>
            </tr>
        </table>`;
    }

    const validateFn = (userInput) => {
        const standardizedInput = userInput.replace(/,/g, "").trim(); // Remove commas from user input
        const standardizedRoundedNum = roundedNum.replace(/,/g, ""); // Remove commas from the rounded number
        const isCorrect = standardizedInput === standardizedRoundedNum;
        displayHintAndFeedback(isCorrect, hint); // Updates UI based on correctness
        return isCorrect;
    };

    return new Problem(
        question,
        roundedNum,
        validateFn,
        hint,
        false,
        "P7ozJW8LSxw",
        ""
    );
}

function roundToDecimalPlace(number, decimalPlaces) {
    const factor = Math.pow(10, decimalPlaces);
    return Math.round((number + Number.EPSILON) * factor) / factor;
}

function roundNumber(number, type) {
    switch (type) {
        case "tens":
            return Math.round(number / 10) * 10;
        case "hundreds":
            return Math.round(number / 100) * 100;
        case "thousands":
            return Math.round(number / 1000) * 1000;
        case "tenths":
            return roundToDecimalPlace(number, 1);
        case "hundredths":
            return roundToDecimalPlace(number, 2);
        default:
            return number; // No rounding if type is not recognized
    }
}


      //Fractions//
      function generateSimplifyProblem() {
        let num1 = Math.floor(Math.random() * 10) + 2; // Random number between 2 and 11
        let num2 = Math.floor(Math.random() * 10) + 2; // Random number between 2 and 11
        let num3 = Math.floor(Math.random() * 10) + 2; // Random number between 2 and 11
        let num4 = num1 * num2; // Creates a composite number ensuring a common factor
        let num5 = num1 * num3; // Creates another composite number with a common factor

        const commonFactor = calculateGCF(num4, num5);
        const simplifiedNumerator = num4 / commonFactor;
        const simplifiedDenominator = num5 / commonFactor;

        const question = `Simplify: <span class="frac"><sup>${num4}</sup><span>&frasl;</span><sub>${num5}</sub></span> don't convert to a mixed number`;
        const answer = simplifiedNumerator + "/" + simplifiedDenominator;
        //foobar
        const hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
           GCF of ${num4} and ${num5} = ${commonFactor}
        </td>
        <td>
            Find the greatest common factor (GCF) of ${num4} and ${num5}.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            <span class="frac"><sup>${num4}</sup><span>&frasl;</span><sub>${num5}</sub></span> &divide;<span class="frac"><sup>${commonFactor}</sup><span>&frasl;</span><sub>${commonFactor}</sub></span> = <span class="frac"><sup>${num4/commonFactor}</sup><span>&frasl;</span><sub>${num5/commonFactor}</sub></span>
            
        </td>
        <td>
            Divide the numerator and denominator by ${commonFactor}(GCF)
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            Simplified answer =  <span class="frac"><sup>${simplifiedNumerator}</sup><span>&frasl;</span><sub>${simplifiedDenominator}</sub></span>
        </td>
        <td>
            Finally, express the simplified fraction 
        </td>
    </tr>
    ${simplifiedDenominator === 1 ? `
    <tr>
        <td>4</td>
        <td>
            ${simplifiedNumerator} = ${simplifiedNumerator}
        </td>
        <td>
            If the denominator is 1, the simplified result is simply the numerator
        </td>
    </tr>` : ''}
</table>`;


        // Adjust the validateFn to properly compare the user's input against the correct answer
        const validateFn = (userInput) => {
          // Trim and remove any spaces to standardize the input
          const standardizedInput = userInput.trim().replace(/\s+/g, '');

          // Convert both parts of the answer to numbers for a numerical comparison
          const [userNumerator, userDenominator] = standardizedInput.split('/').map(Number);

          // Check if the input is in fraction format and correctly simplified
          const isFractionCorrect = userNumerator === simplifiedNumerator &&
            (simplifiedDenominator === 1 ? true : userDenominator === simplifiedDenominator);

          // Check if the input is a whole number and the simplified denominator is 1, implying a whole number answer
          const isWholeNumberCorrect = simplifiedDenominator === 1 &&
            userNumerator === simplifiedNumerator &&
            (standardizedInput === `${simplifiedNumerator}` || userDenominator === undefined);

          const isCorrect = isFractionCorrect || isWholeNumberCorrect;

          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };


        return new Problem(question, answer, validateFn, hint, false,
  "4CKDqvddhhg",
  "",);
      }
      function generateDecimalToFractionProblem() {
  // Choose denominator (10 or 100)
  const denominator = Math.random() < 0.5 ? 10 : 100;

  // Pick a whole number part 1–10
  const wholeNumber = Math.floor(Math.random() * 10) + 1;

  // Pick a numerator
  const numerator = Math.floor(Math.random() * denominator);

  // Build raw fraction
  const rawFraction =
    numerator === 0
      ? `${wholeNumber}`
      : `${wholeNumber} ${numerator}/${denominator}`;

  // Simplify numerator/denominator
  function gcd(a, b) {
    return b === 0 ? a : gcd(b, a % b);
  }
  let g = gcd(numerator, denominator);
  const simpNum = numerator / g;
  const simpDen = denominator / g;

  const simplifiedFraction =
    numerator === 0
      ? `${wholeNumber}`
      : simpDen === 1
      ? `${wholeNumber + simpNum}`
      : `${wholeNumber} ${simpNum}/${simpDen}`;

  // Decimal value
  const decimalValue = (wholeNumber + numerator / denominator).toFixed(
    denominator === 10 ? 1 : 2
  );

  // Question
  const question = `Write ${decimalValue} as a fraction (simplify if possible).`;

  // Hint
  let hint = `
  <table border="1" cellpadding="5">
    <tr><td>Step</td><td>Explanation</td></tr>
    <tr>
      <td>${decimalValue}</td>
      <td>Look at the place value. Digits after the decimal give the numerator, and denominator is ${denominator}.</td>
    </tr>
    <tr>
      <td>${rawFraction}</td>
      <td>That’s the raw fraction form.</td>
    </tr>
    <tr>
      <td>${simplifiedFraction}</td>
      <td>Now simplify by dividing top and bottom by ${g}.</td>
    </tr>
  </table>
  `;

  // Validator
  const validateFn = (userInput) => {
    const standardized = userInput.trim().replace(/\s+/g, "");

    const correctRaw = rawFraction.replace(/\s+/g, "");
    const correctSimp = simplifiedFraction.replace(/\s+/g, "");

    const isCorrect =
      standardized === correctRaw || standardized === correctSimp;

    // If they gave unsimplified version, mark correct but nudge
    if (standardized === correctRaw && correctRaw !== correctSimp) {
      displayHintAndFeedback(true, hint + "<br><em>You could simplify further!</em>");
      return true;
    }

    displayHintAndFeedback(isCorrect, hint);
    return isCorrect;
  };

  return new Problem(
    question,
    simplifiedFraction,
    validateFn,
    hint,
    false,
    "jF5v9JmsF8o", // Teaching video ID (placeholder)
    "" // Example video ID
  );
}

      function generateFractionToDecimalProblem() {
  // Whole number 1..10
  const whole = Math.floor(Math.random() * 10) + 1;

  // Denominator 10 or 100
  const denom = Math.random() < 0.5 ? 10 : 100;

  // Proper numerator: 1..(denom-1)
  const numer = Math.floor(Math.random() * (denom - 1)) + 1;

  // Build the *exact* decimal string with the right number of places
  const decimalPart =
    denom === 10
      ? String(numer).padStart(1, "0")         // tenths
      : String(numer).padStart(2, "0");        // hundredths

  const decimalAnswer = `${whole}.${decimalPart}`;
  const question = `Write the mixed number as a decimal: ${whole} <span class="frac"><sup>${numer}</sup><span>&frasl;</span><sub>${denom}</sub></span>`;

  // Helpful hint: place value visualization
  const placeName = denom === 10 ? "tenths" : "hundredths";
  const underlined = denom === 10
    ? `<u>${decimalPart[0]}</u>`
    : `<u>${decimalPart[0]}</u>${decimalPart[1] ? decimalPart[1] : ""}`;

  const hint = `
  Convert the fractional part to decimal using place value:<br><br>
  <table border="1" cellpadding="6" style="border-collapse:collapse; text-align:center;">
    <tr><th>Step</th><th>Work</th><th>Why</th></tr>
    <tr>
      <td>1</td>
      <td><span class="frac"><sup>${numer}</sup><span>&frasl;</span><sub>${denom}</sub></span> = ${denom === 10 ? (numer/10).toFixed(1) : (numer/100).toFixed(2)}</td>
      <td>Denominator ${denom} means ${placeName} place.</td>
    </tr>
    <tr>
      <td>2</td>
      <td>${whole} + ${denom === 10 ? (numer/10).toFixed(1) : (numer/100).toFixed(2)} = <strong>${decimalAnswer}</strong></td>
      <td>Write the mixed number as a decimal.</td>
    </tr>
    <tr>
      <td>3</td>
      <td style="white-space:nowrap">${whole}.<span style="border:1px solid #000; padding:2px">${underlined}</span>${denom===100 && decimalPart[1] ? `<span>${decimalPart[1]}</span>` : ``}</td>
      <td>The digit(s) after the decimal go to the ${placeName}.</td>
    </tr>
  </table>`;

  // Validate: accept "7.3" or "7.30" etc. Compare numerically.
  const validateFn = (userInput) => {
    const cleaned = (userInput || "").trim();
    const isCorrect =
      !isNaN(cleaned) &&
      parseFloat(cleaned) === parseFloat(decimalAnswer);

    displayHintAndFeedback(isCorrect, hint);
    return isCorrect;
  };

  return new Problem(
    question,
    decimalAnswer,            // canonical answer string
    validateFn,
    hint,
    false,                    // no extra input
    "",                       // teaching video ID (optional)
    ""                        // example video ID (optional)
  );
}

      function generateAddSubtractMixedProblem() {
        const isAddition = Math.random() < 0.5;
        let whole1 = Math.floor(Math.random() * 8) + 3;
        const fractionNumerator1 = Math.floor(Math.random() * 7) + 1;
        const fractionDenominator1 = fractionNumerator1 + Math.floor(Math.random() * (7 - fractionNumerator1)) + 1;


        const originalWhole1 = whole1;

        let whole2 = Math.floor(Math.random() * (whole1 - 1)) + 1;
        const fractionNumerator2 = Math.floor(Math.random() * 7) + 1;
        const fractionDenominator2 = fractionNumerator2 + Math.floor(Math.random() * (7 - fractionNumerator2)) + 1;

        // Calculate the improper numerators for the fractions


        const commonDenominator = lcm(fractionDenominator1, fractionDenominator2);
        let adjustedNumerator1 = fractionNumerator1 * (commonDenominator / fractionDenominator1);
        const originaladjustedNumerator1 = adjustedNumerator1;
        const adjustedNumerator2 = fractionNumerator2 * (commonDenominator / fractionDenominator2);
        let resultFractionNumerator;
        if (isAddition) {
          const totalNumerator = adjustedNumerator1 + adjustedNumerator2;
          if (totalNumerator >= commonDenominator) {
            whole1 += Math.floor(totalNumerator / commonDenominator); // Correctly adjust the whole part based on the sum
            resultFractionNumerator = totalNumerator % commonDenominator; // Update the numerator to reflect the fractional part
          } else {
            resultFractionNumerator = totalNumerator;
          }
        } else {
          if (adjustedNumerator1 < adjustedNumerator2) {
            whole1 -= 1;
            adjustedNumerator1 += commonDenominator;
          }
          resultFractionNumerator = adjustedNumerator1 - adjustedNumerator2;
        }


        const gcdResult = calculateGCF(resultFractionNumerator, commonDenominator);
        let simplifiedNumerator = resultFractionNumerator / gcdResult;
        let simplifiedDenominator = commonDenominator / gcdResult;

        let resultWhole = isAddition ? whole1 + whole2 : whole1 - whole2;

        // Calculate the final gcd for further simplification if needed
        const finalGcd = calculateGCF(simplifiedNumerator, simplifiedDenominator);
        let finalNumerator = simplifiedNumerator / finalGcd;
        let finalDenominator = simplifiedDenominator / finalGcd;

        // Determine if there's a whole part in the final answer
        const finalWholePart = Math.floor(finalNumerator / finalDenominator);
        finalNumerator %= finalDenominator;

        // Adjust answer formatting based on whether the numerator is 0
        let answer;
        if (finalNumerator === 0) {
          answer = `${resultWhole}`;
        } else {
          answer = `${resultWhole > 0 ? resultWhole + ' ' : ''}${finalNumerator}/${finalDenominator}`;
        }

        const question = `${originalWhole1}<span class="frac"><sup>${fractionNumerator1}</sup><span>&frasl;</span><sub>${fractionDenominator1}</sub></span>${isAddition ? ' + ' : ' - '} ${whole2}<span class="frac"><sup>${fractionNumerator2}</sup><span>&frasl;</span><sub>${fractionDenominator2}</sub></span>   Simplify your answer`;
        // Initialize the hint with the table structure and common first step
        let hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step:</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
             Given ${originalWhole1}<span class="frac"><sup>${fractionNumerator1}</sup><span>&frasl;</span><sub>${fractionDenominator1}</sub></span> and  ${whole2}<span class="frac"><sup>${fractionNumerator2}</sup><span>&frasl;</span><sub>${fractionDenominator2}</sub></span> <br> LCM =  ${commonDenominator}
        </td>
        <td>
            Find a common denominator for ${fractionDenominator1} and ${fractionDenominator2} <br> LCM = ${commonDenominator} 
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
             Adjust fractions to have a common denominator:<br>
             ${originalWhole1}<span class="frac"><sup>${fractionNumerator1}  &bull;  ${commonDenominator/fractionDenominator1}</sup><span>&frasl;</span><sub>${fractionDenominator1}  &bull;  ${commonDenominator/fractionDenominator1}</sub></span> = ${originalWhole1}<span class="frac"><sup>${originaladjustedNumerator1}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> <br><br>
             ${whole2}<span class="frac"><sup>${fractionNumerator2}  &bull;  ${commonDenominator/fractionDenominator2}</sup><span>&frasl;</span><sub>${fractionDenominator2}  &bull;  ${commonDenominator/fractionDenominator2}</sub></span> = ${whole2}<span class="frac"><sup>${adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span>
        <td>
           Multiply the numerator and denominator of each fraction so the denominator is ${commonDenominator}
        </td>
    </tr>`;

        if (!isAddition) {
          if (originaladjustedNumerator1 < adjustedNumerator2) {
            // Subtraction with borrowing
            hint += `<tr>
            <td>3</td>
            <td>
                Borrow from the whole number, adjusting the numerator accordingly:<br>
                ${originalWhole1} <span class="frac"><sup> ${originaladjustedNumerator1} </sup><span>&frasl;</span><sub>${commonDenominator} </sub></span> =  ${(originalWhole1-1) } <span class="frac"><sup>${adjustedNumerator1 }</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> <br><br>
                ${(originalWhole1-1) } <span class="frac"><sup>${adjustedNumerator1 }</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> - ${whole2}<span class="frac"><sup>${adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> = ${originalWhole1 - whole2-1}<span class="frac"><sup>${adjustedNumerator1-adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span>
            </td>
            <td>
                Adjust for borrowing before subtracting the fractions.
            </td>
        </tr>`;
          } else {
            // Subtraction without borrowing
            hint += `<tr>
            <td>3</td>
            <td>
                Subtract the fractions directly:<br>
                ${originalWhole1}<span class="frac"><sup>${adjustedNumerator1}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> - ${whole2}<span class="frac"><sup>${adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> 
                = ${originalWhole1-whole2}<span class="frac"><sup>${resultFractionNumerator}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span>
            </td>
            <td>
                Subtract the numerators, while the denominator remains the same.
            </td>
        </tr>`;
          }
        } else {
          if (adjustedNumerator1 + adjustedNumerator2 >= commonDenominator) {
            // Addition with carry
            hint += `<tr>
            <td>3</td>
            <td>
                ${originalWhole1}<span class="frac"><sup>${originaladjustedNumerator1}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> + 
            ${whole2}<span class="frac"><sup>${adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> = ${originalWhole1+whole2} <span class="frac"><sup>${originaladjustedNumerator1+adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> = ${originalWhole1+whole2+1} <span class="frac"><sup>${originaladjustedNumerator1+adjustedNumerator2-commonDenominator}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span>
            
            </td>
            <td>
                Convert excess fraction part into a whole number, adjusting the numerator accordingly.
            </td>
        </tr>`;
          } else {
            // Addition without carry
            hint += `<tr>
            <td>3</td>
            <td>
                Add the fractions directly:<br>
                ${originalWhole1}<span class="frac"><sup>${adjustedNumerator1}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> + ${whole2}<span class="frac"><sup>${adjustedNumerator2}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span> 
                = ${originalWhole1+whole2}<span class="frac"><sup>${resultFractionNumerator}</sup><span>&frasl;</span><sub>${commonDenominator}</sub></span>
            </td>
            <td>
                Add the numerators, while the denominator remains the same.
            </td>
        </tr>`;
          }
        }

        // Simplification and result presentation step
        hint += `<tr>
    <td>4</td>
    <td>
         Simplify the result, if possible. <br>
        ${resultWhole}<span class="frac"><sup>${resultFractionNumerator}</sup><span>&frasl;</span><sub>${commonDenominator*finalGcd}</sub></span> = ${resultWhole}<span class="frac"><sup>${finalNumerator}</sup><span>&frasl;</span><sub>${finalDenominator}</sub></span>
    </td>
    <td>
        The result of the operation is simplified, ensuring the fraction is in its simplest form. This makes it easier to understand and work with.
    </td>
</tr>`;

        if (finalNumerator === 0) {
          hint += `<tr>
        <td>5</td>
        <td>
            ${resultWhole}<span class="frac"><sup>${finalNumerator}</sup><span>&frasl;</span><sub>${finalDenominator}</sub></span> = ${resultWhole}.
        </td>
        <td>
            Since the final numerator is 0, the fraction reduces to just the whole number value, simplifying the result.
        </td>
    </tr>`;
        }

        // Closing the table tag
        hint += `</table>`;

        // Closing the table tag
        hint += `</table>`;



        const validateFn = (userInput) => {
          const isCorrect = userInput.trim() === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "h7Vs7uUPZrE",
  "",
);
      }
      function generateCompareFractionsQuestion() {
    let question, answer, hint;
    let numerator, denominator, numerator2, denominator2; // Declare these variables outside the block
    let equivalentChance = Math.random(); // Random chance for equivalence
    const equivalentFractionChance = 0.33; // 33% chance for equivalent fractions

    // Helper functions for comparing fractions and decimals
    const compareFractions = (num1, denom1, num2, denom2) => {
        const crossProduct1 = num1 * denom2;
        const crossProduct2 = num2 * denom1;
        return crossProduct1 > crossProduct2 ? ">" : crossProduct1 < crossProduct2 ? "<" : "=";
    };

    const compareDecimals = (num1, num2) => {
        return num1 > num2 ? ">" : num1 < num2 ? "<" : "=";
    };

    // Set up display for conditional buttons
    document.getElementById("conditionalButtons").style.display = "block";
    document.getElementById("lessThanButton").style.display = "inline-block";
    document.getElementById("equalsButton").style.display = "inline-block";
    document.getElementById("greaterThanButton").style.display = "inline-block";
    document.getElementById("userAnswer").style.display = "none";

    // Generate the first fraction
    numerator = Math.floor(Math.random() * 9) + 1;
    denominator = Math.floor(Math.random() * (9 - numerator)) + numerator; // Ensure fraction is <= 1

    // Generate the second fraction
    denominator2 = denominator * (Math.floor(Math.random() * 9) + 1); // Denominator is a multiple of the first
    if (equivalentChance < equivalentFractionChance) {
        // Make the fractions equivalent
        numerator2 = (denominator2 / denominator) * numerator;
    } else {
        // Generate a random numerator ensuring the fractions are not equivalent
        numerator2 = Math.floor(Math.random() * (denominator2 - 1)) + 1;
        // Ensure numerator2 isn't accidentally equivalent
        while ((numerator2 / denominator2) === (numerator / denominator)) {
            numerator2 = Math.floor(Math.random() * (denominator2 - 1)) + 1;
        }
    }

    // Construct the question and answer
    question = `Choose >, <, or =: <span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span> ____ <span class="frac"><sup>${numerator2}</sup><span>&frasl;</span><sub>${denominator2}</sub></span>`;
    answer = compareFractions(numerator, denominator, numerator2, denominator2);

    // Create the hint
    const crossProduct1 = numerator * denominator2;
    const crossProduct2 = numerator2 * denominator;
    hint = `<table border="1" cellpadding="5">
        <tr>
            <td colspan="2">Step</td>
            <td>Explanation</td>
        </tr>
        <tr>
            <td>1</td>
            <td>
                ${numerator} * ${denominator2} = ${crossProduct1}<br>
                ${numerator2} * ${denominator} = ${crossProduct2}
            </td>
            <td>
                Cross multiply to compare the fractions.
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>
                ${crossProduct1} ${compareFractions(numerator, denominator, numerator2, denominator2)} ${crossProduct2}
            </td>
            <td>
                Evaluate the cross products to determine the relationship.
            </td>
        </tr>
    </table>`;

    // Validation function to check user's input
    const validateFn = (userInput) => {
        const isCorrect = userInput === answer;
        displayHintAndFeedback(isCorrect, hint); // Use hint constructed within the scope
        return isCorrect;
    };

    return new Problem(
        question,
        answer,
        validateFn,
        hint,
        false,
        "u_QTuWj107o",
        "",
    );
}

      function generateMixedToImproperProblem() {
        const whole = Math.floor(Math.random() * 5) + 1;
        const fractionNumerator = Math.floor(Math.random() * 8) + 1;
        const fractionDenominator = Math.floor(Math.random() * (8 - fractionNumerator)) + fractionNumerator + 1;
        const improperNumerator = whole * fractionDenominator + fractionNumerator;

        // Assume simplifyFraction function returns an object with the simplified fraction and a flag indicating if simplification was done
        const simplified = simplifyFraction(improperNumerator, fractionDenominator);
        const needsSimplification = simplified.numerator !== improperNumerator || simplified.denominator !== fractionDenominator;

        const question = `Convert ${whole}<span class="frac"><sup>${fractionNumerator}</sup><span>&frasl;</span><sub>${fractionDenominator}</sub></span> to a simplified improper fraction`;

        let hint = `<table border="0" cellpadding="1">
    
    <tr>
       <td></td>
        <td style="text-align: center; ">${whole}</td>
        <td>+</td>
        <td><span class="frac"><sup>${fractionNumerator}</sup><span>&frasl;</span><sub>${fractionDenominator}</sub></span></td>
        <td>
    </tr>
    <tr>
       <td></td>
        <td style="text-align: center; ">&#8595;</td>

        <td></td>
        <td> &#8595;</td>
        <td>
    </tr>
    <tr>
        <td></td>
        <td style="text-align: center; "><span class="frac"><sup>${whole * fractionDenominator}</sup><span>&frasl;</span><sub>${fractionDenominator}</sub></span></td>
        <td>+</td>
        <td><span class="frac"><sup>${fractionNumerator}</sup><span>&frasl;</span><sub>${fractionDenominator}</sub></span>= <span class="frac"><sup>${improperNumerator}</sup><span>&frasl;</span><sub>${fractionDenominator}</sub></span></td>
        
       
        
   
    </tr>`;

if (needsSimplification) {
  hint += `<tr>
        <td colspan="3" style="text-align: center;">&#8595;</td>
    </tr>
    <tr>
        <td>4</td>
        <td>
            <span class="frac"><sup>${improperNumerator}</sup><span>&frasl;</span><sub>${fractionDenominator}</sub></span> = <span class="frac"><sup>${simplified.numerator}</sup><span>&frasl;</span><sub>${simplified.denominator}</sub></span>
        </td>
        <td>
            Simplify the fraction if possible.
        </td>
    </tr>
</table>`;
}


        const answer = `${simplified.numerator}/${simplified.denominator}`;

        const validateFn = (userInput) => {
          // Extract numerator and denominator from the user's input
          const inputFraction = userInput.trim().split('/');
          const inputNumerator = parseInt(inputFraction[0], 10);
          const inputDenominator = inputFraction.length > 1 ? parseInt(inputFraction[1], 10) : 1; // Handle whole numbers as fractions with denominator 1

          // Pre-simplified answer, assuming these variables are defined in your problem setup
          // e.g., const simplified = { numerator: 3, denominator: 4 };
          const isCorrect = (inputNumerator === simplified.numerator && inputDenominator === simplified.denominator);

          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "96NOYcnmThU",
  "",);
      }
      function generateImproperToMixedProblem() {
        const denominator = Math.floor(Math.random() * 9) + 2;
        let numerator;
        let remainingNumerator;

        // Generate a random numerator between 10 and 39 (inclusive)
        numerator = Math.floor(Math.random() * 30) + 10;
        // Calculate the remainder when the numerator is divided by the denominator
        remainingNumerator = numerator % denominator;

        // If the remainder is zero, simply add one to the numerator
        if (remainingNumerator === 0) {
          numerator += 1;
          // Recalculate the remainingNumerator to reflect the updated numerator
          remainingNumerator = numerator % denominator;
        }

        // Calculate the whole part of the mixed number
        const wholePart = Math.floor(numerator / denominator);

        // Construct the question and answer strings
        const question = `Convert <span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span> to a mixed number`;
        const answer = `${wholePart} ${remainingNumerator}/${denominator}`;

        //foobar
        const hint = `Divide the fraction <br><br>
      <table cellspacing="0">
    <tr>
        <td></td>
        <td style="text-align: right;">${wholePart}</td>
        <td>Whole</td>
    </tr>
    <tr>
        <td>${denominator}</td>
        <td style="border-left: 1px solid black; border-top: 1px solid black;">${numerator}</td>
        <td></td>
    </tr>
    <tr>
        <td style="border-top: none;"></td>
        <td style="text-align: right;border-bottom: 1px solid black;">${wholePart*denominator}</td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td style="text-align: right;">${numerator - wholePart * denominator}</td>
        <td>New numerator</td>
    </tr>
</table>

<br>This gives you ${wholePart}<span class="frac"><sup>${remainingNumerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span> as the mixed number
`;
        const validateFn = (userInput) => {
          const isCorrect = userInput.trim() === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint,
          false,
          "96NOYcnmThU",
          "",);
      }
      function generateWholeTimesMixedProblem() {
        // Generate a whole number between 2 and 10
        const wholeNumberM = Math.floor(Math.random() * 9) + 2

        // Generate components of the mixed fraction
        const mixedWhole = Math.floor(Math.random() * 5) + 1 // Whole part of mixed fraction
        const mixedFractionNumerator = Math.floor(Math.random() * 7) + 1 // Numerator
        // Ensure the denominator is greater than the numerator
        const mixedFractionDenominator =
          mixedFractionNumerator +
          Math.floor(Math.random() * (8 - mixedFractionNumerator)) +
          1

        // Calculate the product of the whole number and the mixed fraction
        const productWholePart = wholeNumberM * mixedWhole
        const productFractionNumerator = wholeNumberM * mixedFractionNumerator
        const productFractionDenominator = mixedFractionDenominator

        // Simplify the fraction part of the product
        const greatestCommonDivisorM = calculateGCF(
          productFractionNumerator,
          productFractionDenominator,
        )
        let simplifiedNumeratorM =
          productFractionNumerator / greatestCommonDivisorM
        let simplifiedDenominatorM =
          productFractionDenominator / greatestCommonDivisorM

        // Convert to a mixed number if the numerator is greater than the denominator
        const additionalWholePart = Math.floor(
          simplifiedNumeratorM / simplifiedDenominatorM,
        )
        const remainingNumeratorM =
          simplifiedNumeratorM % simplifiedDenominatorM
        // Correctly calculate the total whole part by adding the productWholePart with additionalWholePart only once
        const totalWholePart = productWholePart + additionalWholePart
        const finalAnswer =
          remainingNumeratorM > 0
            ? `${totalWholePart} ${remainingNumeratorM}/${simplifiedDenominatorM}`
            : `${totalWholePart}`

        // Construct the question using the provided variables
        const questionM = `Multiply the whole number by the mixed fraction: ${wholeNumberM} × ${mixedWhole}<span class="frac"><sup>${mixedFractionNumerator}</sup><span>&frasl;</span><sub>${mixedFractionDenominator}</sub></span>`

        // Update hint to include conversion and simplification steps
        const hintM = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${wholeNumberM}&bull;${mixedWhole}<span class="frac"><sup>${mixedFractionNumerator}</sup><span>&frasl;</span><sub>${mixedFractionDenominator}</sub></span>
        </td>
        <td>
            Break apart the mixed number.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            ${wholeNumberM}(${mixedWhole} + <span class="frac"><sup>${mixedFractionNumerator}</sup><span>&frasl;</span><sub>${mixedFractionDenominator}</sub></span>)
        </td>
        <td>
            Distribute the multiplication over the mixed number.
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            ${wholeNumberM}&bull;${mixedWhole} + ${wholeNumberM}&bull;<span class="frac"><sup>${mixedFractionNumerator}</sup><span>&frasl;</span><sub>${mixedFractionDenominator}</sub></span>
        </td>
        <td>
            Multiply each part of the mixed number by the whole number.
        </td>
    </tr>
    <tr>
        <td>4</td>
        <td>
            ${productWholePart} + <span class="frac"><sup>${productFractionNumerator}</sup><span>&frasl;</span><sub>${productFractionDenominator}</sub></span>
        </td>
        <td>
            Multiply to find the product of the whole number and the mixed number parts.
        </td>
    </tr>
    <tr>
        <td>5</td>
        <td>
            ${productWholePart} + ${additionalWholePart} ${remainingNumeratorM ? `<span class="frac"><sup>${remainingNumeratorM}</sup><span>&frasl;</span><sub>${simplifiedDenominatorM}</sub></span>` : ""}
        </td>
        <td>
            Convert the improper fraction to a mixed number and simplify if possible. ${remainingNumeratorM ? "" : "No fractional part remains."}
        </td>
    </tr>
    <tr>
        <td>6</td>
        <td>
            ${productWholePart + additionalWholePart} ${remainingNumeratorM ? `<span class="frac"><sup>${remainingNumeratorM}</sup><span>&frasl;</span><sub>${simplifiedDenominatorM}</sub></span>` : ""}
        </td>
        <td>
            Add the whole numbers to complete the multiplication. ${remainingNumeratorM ? "" : "No fractional part remains."}
        </td>
    </tr>
</table>
`

        // Validation function to check the user's answer
        const validateFn = (userInput) => {
          // Standardize user input and define regex to extract potential whole number and fraction parts
          const inputRegex = /^(\d+)(?:\s+(\d+)\/(\d+))?$/
          const match = userInput.match(inputRegex)

          // Ensure the input matches expected format
          if (!match) {
            displayHintAndFeedback(false, hintM) // Incorrect answer format
            return false
          }

          const inputWholeNumber = parseInt(match[1], 10)
          const inputNumerator = match[2] ? parseInt(match[2], 10) : 0
          const inputDenominator = match[3] ? parseInt(match[3], 10) : 1

          // Compute the validity of the user's input
          const isCorrect =
            inputWholeNumber === totalWholePart &&
            inputNumerator === remainingNumeratorM &&
            inputDenominator === simplifiedDenominatorM

          // Provide feedback based on the correctness of the answer
          displayHintAndFeedback(isCorrect, hintM)

          return isCorrect
        }

        return new Problem(
          questionM,
          finalAnswer,
          validateFn,
          hintM,
          false,
          "4JV6fPXZPXA",
          "",
        )
      }
      function generateDivideFractionsProblem() {
        const numerator1 = Math.floor(Math.random() * 8) + 1; // 1 to 8
        const denominator1 = Math.floor(Math.random() * (8 - numerator1)) + numerator1 + 1; // Ensuring fraction is < 1

        const numerator2 = Math.floor(Math.random() * 8) + 1; // 1 to 8
        const denominator2 = Math.floor(Math.random() * (8 - numerator2)) + numerator2 + 1; // Ensuring fraction is < 1

        // Multiply the first fraction by the reciprocal of the second
        const productNumerator = numerator1 * denominator2;
        const productDenominator = denominator1 * numerator2;

        // Simplify the fraction
        const simplifiedAnswer = simplifyFraction(productNumerator, productDenominator);

        // Check if it's an improper fraction and convert to mixed number if necessary
        const wholePart = Math.floor(simplifiedAnswer.numerator / simplifiedAnswer.denominator);
        const remainingNumerator = simplifiedAnswer.numerator % simplifiedAnswer.denominator;
        let answer;
        if (wholePart > 0 && remainingNumerator > 0) {
          answer = `${wholePart} ${remainingNumerator}/${simplifiedAnswer.denominator}`;
        } else if (wholePart > 0) {
          answer = `${wholePart}`;
        } else {
          answer = `${simplifiedAnswer.numerator}/${simplifiedAnswer.denominator}`;
        }

        const question = `Divide <span class="frac"><sup>${numerator1}</sup><span>&frasl;</span><sub>${denominator1}</sub></span> &divide; <span class="frac"><sup>${numerator2}</sup><span>&frasl;</span><sub>${denominator2}</sub></span>, and write your answer as a simplified fraction or a mixed number.`;

        // Include conversion to mixed number in the hint if applicable
        let hint = `<table border="1" cellpadding="5">
<tr>
    <td colspan="2">Step</td>
    <td>Explanation</td>
</tr>
<tr>
    <td>1</td>
    <td>
        <span class="frac"><sup>${numerator1}</sup><span>&frasl;</span><sub>${denominator1}</sub></span> &divide; 
        <span class="frac"><sup>${numerator2}</sup><span>&frasl;</span><sub>${denominator2}</sub></span>
    </td>
    <td>
        Starting expression for division of fractions.
    </td>
</tr>
<tr>
    <td>2</td>
    <td>
        <span class="frac"><sup>${numerator1}</sup><span>&frasl;</span><sub>${denominator1}</sub></span> &bull; 
        <span class="frac"><sup>${denominator2}</sup><span>&frasl;</span><sub>${numerator2}</sub></span>
    </td>
    <td>
        Multiply by the reciprocal of the second fraction.
    </td>
</tr>
<tr>
    <td>3</td>
    <td>
        <span class="frac"><sup>${numerator1} &bull; ${denominator2}</sup><span>&frasl;</span><sub>${denominator1} &bull; ${numerator2}</sub></span> = 
        <span class="frac"><sup>${productNumerator}</sup><span>&frasl;</span><sub>${productDenominator}</sub></span>
    </td>
    <td>
        Perform the multiplication to find the product.
    </td>
</tr>
<tr>
    <td>4</td>
    <td>
        <span class="frac"><sup>${productNumerator}</sup><span>&frasl;</span><sub>${productDenominator}</sub></span> = 
        <span class="frac"><sup>${simplifiedAnswer.numerator}</sup><span>&frasl;</span><sub>${simplifiedAnswer.denominator}</sub></span>
    </td>
    <td>
        Simplify the fraction if possible.
    </td>
</tr>
`;
        if (simplifiedAnswer.denominator === 1) {
          hint += `<tr>
    <td>5</td>
    <td>${simplifiedAnswer.numerator}</td>
    <td>The denominator is 1, indicating the value is a whole number.</td>
</tr>`;
        }
        if (wholePart > 0 && remainingNumerator > 0) {
          hint += `<tr>
    <td>5</td>
    <td>
        <span class="frac"><sup>${simplifiedAnswer.numerator}</sup><span>&frasl;</span><sub>${simplifiedAnswer.denominator}</sub></span> = ${answer}
    </td>
    <td>
        Convert to a mixed number if the fraction is improper.
    </td>
</tr>`;
        }
        hint += `</table>`;

        const validateFn = (userInput) => {
          const isCorrect = userInput.trim() === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "RAKwouL-lTc",
  "cARsEw-s8Fg",);
      }
      function generateDivideMixedNumbersProblem() {
        // Generate mixed numbers
        const whole1 = Math.floor(Math.random() * 4) + 1;
        const fractionDenominator1 = Math.floor(Math.random() * 7) + 3;
        const fractionNumerator1 = Math.floor(Math.random() * (fractionDenominator1-2)) + 1;
        
        
        

        const whole2 = Math.floor(Math.random() * 3) + 1;
        const fractionDenominator2 = Math.floor(Math.random() * 7) + 3;
        const fractionNumerator2 = Math.floor(Math.random() * (fractionDenominator2-2)) + 1;
        
        
        

        // Convert mixed numbers to improper fractions
        const improperNumerator1 = whole1 * fractionDenominator1 + fractionNumerator1;
        const improperDenominator1 = fractionDenominator1;
        const improperNumerator2 = whole2 * fractionDenominator2 + fractionNumerator2;
        const improperDenominator2 = fractionDenominator2;

        // Calculate the result of division
        const answerNumerator = improperNumerator1 * improperDenominator2;
        const answerDenominator = improperDenominator1 * improperNumerator2;
        const simplifiedAnswer = simplifyFraction(answerNumerator, answerDenominator);

        // Question and hint construction
        const question = `Divide the mixed numbers: ${whole1}<span class="frac"><sup>${fractionNumerator1}</sup><span>&frasl;</span><sub>${fractionDenominator1}</sub></span> ÷ ${whole2}<span class="frac"><sup>${fractionNumerator2}</sup><span>&frasl;</span><sub>${fractionDenominator2}</sub></span>`;
        const hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            Convert ${whole1}<span class="frac"><sup>${fractionNumerator1}</sup><span>&frasl;</span><sub>${fractionDenominator1}</sub></span> to <span class="frac"><sup>${improperNumerator1}</sup><span>&frasl;</span><sub>${improperDenominator1}</sub></span>   <br>
            Convert ${whole2}<span class="frac"><sup>${fractionNumerator2}</sup><span>&frasl;</span><sub>${fractionDenominator2}</sub></span> to <span class="frac"><sup>${improperNumerator2}</sup><span>&frasl;</span><sub>${improperDenominator2}</sub></span>     
        </td>
        <td>
            First, convert the mixed numbers to improper fractions.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            <span class="frac"><sup>${improperNumerator1}</sup><span>&frasl;</span><sub>${improperDenominator1}</sub></span> &bull; <span class="frac"><sup>${improperDenominator2}</sup><span>&frasl;</span><sub>${improperNumerator2}</sub></span> 
        </td>
        <td>
            Then, flip the second fraction and multiply.
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
           <span class="frac"><sup>${improperNumerator1}&bull;${improperDenominator2}</sup><span>&frasl;</span><sub>${improperDenominator1}&bull;${improperNumerator2}</sub></span> = <span class="frac"><sup>${answerNumerator}</sup><span>&frasl;</span><sub>${answerDenominator}</sub></span>      
        </td>
        <td>
            Calculate the multiplication to get the preliminary answer.
        </td>
    </tr>
    <tr>
        <td>4</td>
        <td>
            <span class="frac"><sup>${answerNumerator}</sup><span>&frasl;</span><sub>${answerDenominator}</sub></span> = <span class="frac"><sup>${simplifiedAnswer.numerator}</sup><span>&frasl;</span><sub>${simplifiedAnswer.denominator}</sub></span>         
        </td>
        <td>
            Finally, simplify the result.
        </td>
    </tr>
</table>
`;

        // Validate function tailored to your application
        let wholePart; // Change from const to let

        const validateFn = (userInput) => {
          let userNumerator, userDenominator, wholePart = 0;

          // Splitting the userInput into wholePart, userNumerator, and userDenominator
          const parts = userInput.split(' ');

          if (parts.length === 1) {
            const [userNumeratorStr, userDenominatorStr] = parts[0].split('/').map(Number);
            userNumerator = userNumeratorStr;
            userDenominator = userDenominatorStr;
          } else if (parts.length === 2) {
            wholePart = parseInt(parts[0]);
            const [userNumeratorStr, userDenominatorStr] = parts[1].split('/').map(Number);
            userNumerator = userNumeratorStr;
            userDenominator = userDenominatorStr;
          }

          // Convert mixed number to improper fraction
          userNumerator = userNumerator + wholePart * userDenominator;

          const isCorrect = userNumerator === simplifiedAnswer.numerator && userDenominator === simplifiedAnswer.denominator;
          displayHintAndFeedback(isCorrect, hint); // Adjust according to your feedback mechanism
          return isCorrect;
        };


        return new Problem(question, `${simplifiedAnswer.numerator}/${simplifiedAnswer.denominator}`, validateFn, hint, false,
  "cARsEw-s8Fg",
  "",);
      }
      function simplifyFraction(numerator, denominator) {
        function gcd(a, b) {
          return b ? gcd(b, a % b) : a;
        }
        const greatestCommonDivisor = gcd(numerator, denominator);
        return {
          numerator: numerator / greatestCommonDivisor,
          denominator: denominator / greatestCommonDivisor
        };
      }
      function simplifyRatio(num1, num2) {
        const gcdValue = gcd(num1, num2);
        return `${num1 / gcdValue}:${num2 / gcdValue}`;
      }
      
      

      //Decimals - Percent//
      function generateComparisonQuestion() {
    let question, answer, hint;
    let num1, num2; // Variables for decimals

    // Helper function for comparing decimals
    const compareDecimals = (num1, num2) => {
        return num1 > num2 ? ">" : num1 < num2 ? "<" : "=";
    };

    // Set up display for conditional buttons
    document.getElementById("conditionalButtons").style.display = "block";
    document.getElementById("lessThanButton").style.display = "inline-block";
    document.getElementById("equalsButton").style.display = "inline-block";
    document.getElementById("greaterThanButton").style.display = "inline-block";
    document.getElementById("userAnswer").style.display = "none";

    // Generate decimals with whole number as 0 almost always
    const zeroWholeChance = 0.9; // 90% chance for the whole number to be 0
    const wholeNumber1 = Math.random() < zeroWholeChance ? 0 : Math.floor(Math.random() * 10);
    const wholeNumber2 = Math.random() < zeroWholeChance ? 0 : Math.floor(Math.random() * 10);

    const decimalPlaces1 = Math.random() < 0.67 ? 2 : 3; // About 2/3 chance for different decimal places
    const decimalPlaces2 = Math.random() < 0.67 ? 1 : 3;

    num1 = parseFloat(`${wholeNumber1}.${(Math.random() * Math.pow(10, decimalPlaces1)).toFixed(decimalPlaces1)}`);
    num2 = parseFloat(`${wholeNumber2}.${(Math.random() * Math.pow(10, decimalPlaces2)).toFixed(decimalPlaces2)}`);

    // Construct the question and answer
    question = `Choose >, <, or =: ${num1} ____ ${num2}`;
    answer = compareDecimals(num1, num2);

    // Create hint
    hint = `<table border="1" cellpadding="5">
        <tr>
            <td colspan="2">Step</td>
            <td>Explanation</td>
        </tr>
        <tr>
            <td>1</td>
            <td>
                Compare the numbers directly:<br>
                ${num1.toFixed(decimalPlaces1)} vs ${num2.toFixed(decimalPlaces2)}
            </td>
            <td>
                Evaluate each number by comparing their place values, starting from the leftmost digit.
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>
                ${num1.toFixed(decimalPlaces1)} ${compareDecimals(num1, num2)} ${num2.toFixed(decimalPlaces2)}
            </td>
            <td>
                Determine the relationship: greater than (>), less than (<), or equal (=).
            </td>
        </tr>
    </table>`;

    // Validation function to check user's input
    const validateFn = (userInput) => {
        const isCorrect = userInput === answer;
        displayHintAndFeedback(isCorrect, hint); // Use hint constructed within the scope
        return isCorrect;
    };

    return new Problem(
        question,
        answer,
        validateFn,
        hint,
        false,
        "nhLZcvfdgqs", // Additional identifier for the problem
        "u_QTuWj107o" // Additional identifier for user interface tracking
    );
}


      function generatePercentOfNumberProblem() {
        const randomPercentage = Math.floor(Math.random() * 126); // Random number between 0 and 125
        const percent = (randomPercentage / 100).toFixed(2); // Convert to percentage with 2 decimal places
        const number = Math.floor(Math.random() * 100) + 1; // 1 to 100 for number
        const answer = (percent * number).toFixed(2); // Round the answer to 2 decimal places

        // Hint explaining the steps to find the percentage of a number
        const hint = `To find ${randomPercentage}% of ${number}: <br><br><table border="1" cellpadding="5">
        <tr>
            <td colspan="2">Step</td>
            <td>Explanation</td>
        </tr>
        <tr>
            <td>1</td>
            <td>
                ${randomPercentage}% &divide; 100 = ${percent}
            </td>
            <td>
                Convert the percent to a decimal.
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>
                ${percent} &bull; ${number} = ${answer}
            </td>
            <td>
                Multiply the decimal by the number.
            </td>
        </tr>
    </table>
    `;

        // Validation function to compare user input with the correct answer
        // Validation function to compare user input with the correct answer
        const validateFn = (userInput) => {
          const userInputTrimmed = userInput.trim();
          const answerTrimmed = answer.toString().trim();
          const isCorrect = parseFloat(userInputTrimmed) === parseFloat(answerTrimmed);
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        const question = `What is ${randomPercentage}% of ${number}?`;

        return new Problem(question, answer.toString(), validateFn, hint, false,
  "AL0-0f9azNo",
  "",);
      }
      function generatePercentDecimalQuestion() {
        const convertToDecimal = Math.random() < 0.5;
        let question, answer, hint;

        if (convertToDecimal) {
          const percent = Math.floor(Math.random() * 200) + 1;
          question = `Convert ${percent}% to a decimal`;
          answer = (percent / 100).toFixed(2);
          hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${percent}%
        </td>
        <td>
            Recognize that this is a percentage.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            ${percent}% ÷ 100 = ${answer}
        </td>
        <td>
            Divide the percentage by 100 to convert it to a decimal.
        </td>
    </tr>
    <tr>
        <td>Answer</td>
        <td>
            ${answer}
        </td>
        <td>
            The decimal equivalent of ${percent}% is ${answer}.
        </td>
    </tr>
</table>`;

        } else {
          const decimal = (Math.random() * 1).toFixed(2);
          question = `Convert ${decimal} to a percent`;
          answer = `${(decimal * 100).toFixed(0)}%`;
          hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${decimal}
        </td>
        <td>
            Recognize that this is a decimal.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            ${decimal} × 100 = ${answer}
        </td>
        <td>
            Multiply the decimal by 100 to convert it to a percentage.
        </td>
    </tr>
    <tr>
        <td>Answer</td>
        <td>
            ${answer}
        </td>
        <td>
            The percentage equivalent of ${decimal} is ${answer}.
        </td>
    </tr>
</table>`;

        }

        // Validation function to compare user input with the answer
        const validateFn = (userInput) => {
          const standardizedInput = convertToDecimal ? parseFloat(userInput).toFixed(2) : userInput.trim();
          const isCorrect = standardizedInput === answer;
          displayHintAndFeedback(isCorrect, hint); // Make sure to call this for incorrect answers too
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "mFxezaGJsMs",
  "SiQbegnH1NA",);
      }

      

      //Ratios//
      function generateRatioProblem() {
        const foodItems = [
  'apples', 'bananas', 'tomatoes', 'potatoes', 'carrots', 'onions', 'lettuce', 'cucumbers', 'peppers', 
  'mushrooms', 'grapes', 'oranges', 'lemons', 'blueberries', 'strawberries', 'pears', 'watermelons', 
  'pineapples', 'peaches', 'plums', 'apricots', 'cherries', 'cantaloupes', 'honeydew', 'kiwis', 
  'mangoes', 'avocados', 'spinach', 'kale', 'broccoli', 'cauliflower', 'zucchini', 'squash', 'garlic', 
  'ginger', 'radishes', 'beets', 'celery', 'parsley', 'basil', 'cilantro', 'mint', 'rosemary', 
  'thyme', 'cabbage', 'asparagus', 'brussels sprouts', 'eggplant', 'pumpkin', 'sweet potatoes', 
  'corn', 'peas', 'beans', 'lentils', 'chickpeas', 'blackberries', 'raspberries', 'cranberries', 
  'pomegranates', 'coconuts', 'dates', 'figs', 'raisins', 'cashews', 'almonds', 'walnuts', 'pecans', 
  'sunflower seeds', 'chia seeds', 'quinoa', 'oats', 'barley', 'rice', 'wheat', 'pasta', 'bread', 
  'milk', 'cheese', 'yogurt', 'butter', 'cream', 'eggs', 'chicken', 'beef', 'pork', 'lamb', 'fish', 
  'shrimp', 'crab', 'lobster', 'scallops', 'tofu', 'tempeh', 'soybeans', 'seitan', 'miso'
];

const animals = [
  'dogs', 'cats', 'horses', 'cows', 'chickens', 'pigs', 'sheep', 'goats', 'rabbits', 'ducks', 
  'geese', 'llamas', 'alpacas', 'turkeys', 'deer', 'foxes', 'wolves', 'bears', 'lions', 'tigers', 
  'elephants', 'giraffes', 'zebras', 'kangaroos', 'koalas', 'pandas', 'monkeys', 'gorillas', 
  'chimpanzees', 'orangutans', 'sloths', 'raccoons', 'squirrels', 'hedgehogs', 'otters', 'badgers', 
  'skunks', 'coyotes', 'buffalo', 'bison', 'yaks', 'camels', 'moose', 'reindeer', 'whales', 
  'dolphins', 'seals', 'penguins', 'eagles', 'hawks', 'falcons', 'owls', 'parrots', 'sparrows', 
  'robins', 'crows', 'ravens', 'pigeons', 'flamingos', 'swans', 'peacocks', 'quail', 'ostriches', 
  'emus', 'turkeys', 'frogs', 'toads', 'snakes', 'lizards', 'turtles', 'alligators', 'crocodiles', 
  'sharks', 'stingrays', 'octopuses', 'squid', 'jellyfish', 'starfish', 'clownfish', 'butterflies', 
  'bees', 'ants', 'ladybugs', 'grasshoppers', 'dragonflies', 'crickets'
];

const stationary = [
  'pens', 'pencils', 'books', 'notebooks', 'markers', 'erasers', 'rulers', 'staplers', 'paper clips', 
  'scissors', 'tape', 'glue sticks', 'highlighters', 'folders', 'binders', 'paper', 'index cards', 
  'sticky notes', 'white-out', 'mechanical pencils', 'gel pens', 'fountain pens', 'pencil sharpeners', 
  'colored pencils', 'crayons', 'paint brushes', 'watercolors', 'sketch pads', 'calendars', 'planners', 
   'desk organizers', 'file holders', 'stamps', 'ink pads', 'envelopes', 'clipboards', 
  'push pins', 'thumbtacks', 'magnifying glass', 'calculator', 'hole punch', 'stencils', 'compass', 
  'protractor', 'erasable pens', 'graph paper', 'carbon paper', 'laminating sheets', 'masking tape', 
  'correction tape', 'colored markers', 'fine liners', 'binder clips', 'rubber bands', 'drawing paper', 
  'cutting mat', 'label maker', 'chalk', 'whiteboard markers', 'blackboard chalk', 'sticky tabs', 
  'filing folders', 'divider tabs', 'report covers', 'document sleeves'
];

        const vehicles = [
  'cars', 'bicycles', 'motorcycles', 'trucks', 'buses', 'vans', 'scooters', 'mopeds', 'tractors', 'golf carts', 
  'ATVs', 'snowmobiles', 'jet skis', 'campers', 'trailers', 'SUVs', 'pickup trucks', 'convertibles', 
  'minivans', 'limousines', 'ambulances', 'fire trucks', 'police cars', 'garbage trucks', 'cement mixers', 
  'semi-trucks', 'tow trucks', 'helicopters', 'airplanes', 'gliders', 'hot air balloons', 'blimps', 
  'skateboards', 'roller skates', 'hoverboards', 'segways', 'electric scooters', 'electric bikes', 
  'electric cars', 'hybrid cars', 'sports cars', 'luxury cars', 'motorhomes', 'microcars', 'submarines', 
  'sailboats', 'yachts', 'canoes', 'kayaks', 'paddleboards', 'rowboats', 'ferries', 'cruise ships', 
  'cargo ships', 'tankers', 'barges', 'speedboats', 'dinghies', 'trains', 'light rail', 'subways', 
  'monorails', 'trolleys', 'funiculars', 'trams', 'rickshaws', 'horse-drawn carriages', 
  'dog sleds', 'handcarts', 'wheelbarrows', 'rickshaws', 'taxis', 'ride-share cars', 'hovercrafts', 'amphibious vehicles', 'all-terrain vehicles', 'snowcats', 'bulldozers', 
  'excavators', 'cranes', 'forklifts', 'backhoes', 'road rollers', 'street sweepers', 'gondolas', 
  'chairlifts', 'paragliders', 'hang gliders', 'ultralight aircraft',  'drones', 
  'spacecraft', 'lunar rovers', 'hydroplanes', 'pontoons', 'longboards', 'kick scooters', 
  'quad bikes', 'go-karts', 'drift cars', 'buggies', 'ice resurfacers', 'log skidders', 'paver machines'
];

        const plants = [
  'trees', 'flowers', 'shrubs', 'ferns', 'cacti', 'succulents', 'vines', 'grasses', 'bamboo', 'palms', 'orchids', 
  'lilies', 'roses', 'tulips', 'daisies', 'mosses', 'herbs', 'vegetables', 'annuals', 'perennials', 
  'bulbs', 'bonsai', 'ivy', 'conifers', 'maples', 'oaks', 'pines', 'cedars', 'spruce', 'willows', 
  'azaleas', 'hydrangeas', 'lavender', 'sunflowers', 'marigolds', 'hibiscus', 'begonias', 'carnations', 
  'petunias', 'poppies', 'chrysanthemums', 'peonies', 'geraniums', 'snapdragons', 'impatiens', 'coleus', 
  'hostas', 'zinnias', 'morning glories', 'honeysuckle', 'wisteria', 'lotus', 'amaryllis', 'caladium', 
  'fiddle leaf fig', 'snake plant', 'monstera', 'philodendron', 'basil', 'thyme', 'mint', 'sage', 'rosemary', 
  'parsley', 'cilantro', 'aloe vera', 'jade plant', 'peace lily', 'yucca', 'bromeliads', 'air plants', 
  'pothos', 'money tree', 'lemon tree', 'orange tree', 'apple tree', 'blueberry bush', 'raspberry bush', 
  'strawberry plant', 'grapevine', 'black-eyed susans', 'camellias', 'gardenias', 'fuchsias', 'nasturtiums', 
  'holly', 'juniper', 'yew', 'sagebrush', 'heather', 'lantana', 'plumeria', 'bougainvillea', 'foxglove', 
  'lupine', 'delphinium', 'bluebells', 'sweet peas', 'alyssum', 'gerbera daisies', 'coreopsis', 'asters', 
  'pentas', 'kalanchoe', 'palm lily', 'papyrus', 'spider plant', 'rubber plant', 'pencil cactus', 
  'boston fern', 'asparagus fern', 'bird of paradise', 'dumb cane', 'dracaena', 'cast iron plant', 
  'milkweed', 'yarrow', 'artemisia', 'echinacea', 'sagebrush', 'veronica', 'catmint', 'asters', 
  'bleeding heart', 'clivia', 'columbine', 'geranium', 'lungwort', 'phlox', 'scaevola', 'torenia', 
  'trumpet vine', 'sweet potato vine', 'butterfly bush', 'chamomile', 'eucalyptus', 'heliotrope', 
  'buddleia', 'sago palm', 'olive tree', 'mimosa', 'redbud', 'dogwood', 'larch', 'magnolia', 
  'birch', 'ginkgo', 'cyprus', 'hickory', 'elm', 'beech', 'cottonwood', 'sycamore', 'mulberry', 
  'sassafras', 'fig', 'hazelnut', 'walnut', 'chestnut'
];


        const utensils = [
  'forks', 'spoons',  'plates', 'cups', 'serving spoons', 'ladles', 'tongs', 'whisks', 
  'spatulas', 'measuring cups', 'measuring spoons', 'mixing bowls', 'cutting boards', 'cheese graters', 
  'peelers', 'garlic presses', 'can openers', 'ice cream scoops', 'salad spinners', 
  'colanders', 'pizza cutters',  'pastry brushes', 'rolling pins', 'meat tenderizers', 
  'thermometers', 'zesters', 'potato mashers', 'egg slicers', 'apple corers', 
  'strainers', 'slotted spoons', 'turners', 'gravy ladles', 'pasta servers', 'wooden spoons', 
  'basting brushes', 'kitchen shears', 'soup ladles', 'egg beaters', 'scissors', 'pastry blenders', 
  'dough scrapers', 'cooking chopsticks', 'funnel', 'tea infusers', 'skewers', 'butter knives', 
  'cake servers', 'cookie cutters',  'sugar tongs', 'tea strainers', 'food mill', 
  'crepe spreader', 'fish turner', 'meat forks', 'silicone baking mats', 'juicers',  
  'butter curler', 'spoon rest', 'salt and pepper shakers', 'kitchen timers', 
  'parchment paper dispensers', 'cheese slicers', 'chopstick holders', 'spice grinders', 'roasting racks', 
  'trivets', 'grill brushes', 'tortilla press', 'rice paddles', 'sushi mats', 'dough cutters'
];



        function pickTwoItems(items) {
          let index1 = Math.floor(Math.random() * items.length);
          let index2;
          do {
            index2 = Math.floor(Math.random() * items.length);
          } while (index1 === index2);
          return [items[index1], items[index2]];
        }

        // Generate two items for each category
        const [food1, food2] = pickTwoItems(foodItems);
        const [animal1, animal2] = pickTwoItems(animals);
        const [stationary1, stationary2] = pickTwoItems(stationary);
        const [vehicle1, vehicle2] = pickTwoItems(vehicles);
        const [plant1, plant2] = pickTwoItems(plants);
        const [utensil1, utensil2] = pickTwoItems(utensils);

        const allItems = [foodItems, animals, stationary, vehicles, plants, utensils];

        function pickThreeItemsFromSameList() {
    // Randomly select one list from the array of lists
    const selectedList = allItems[Math.floor(Math.random() * allItems.length)];
    // Pick three different items from the selected list
    let index1 = Math.floor(Math.random() * selectedList.length);
    let index2, index3;
    
    do {
        index2 = Math.floor(Math.random() * selectedList.length);
    } while (index2 === index1);
    
    do {
        index3 = Math.floor(Math.random() * selectedList.length);
    } while (index3 === index1 || index3 === index2);
    
    return [selectedList[index1], selectedList[index2], selectedList[index3]];
}

// Generate three unique items from the same, randomly selected list
const [item1, item2, item3] = pickThreeItemsFromSameList();
        const randomChoice = Math.floor(Math.random() * 2) + 1;

        // Example of using these variables in a ratio problem
        const amount1 = Math.floor(Math.random() * 10) + 2;
        const amount2 = Math.floor(Math.random() * 10) + 2;
        const amount3 = Math.floor(Math.random() * 10) + 2;

        const type = Math.random() < 0.4 
  ? 19 
  : Math.floor(Math.random() * 18) + 1;
        const casenum = Math.floor(Math.random() * 10) + 2;






        let question, answer;
        switch (type) {
          case 1:
            const num1 = Math.floor(Math.random() * 6) + 2;
            question = `There are ${item1} and  ${item2} in a ratio of ${amount1}:${amount2}. If there are ${(amount1 + amount2)*num1} items in total, how many are ${item1}?`;
            answer = `${amount1*num1}`;
            break;

          case 2: //part to whole
            question = `The library has ${amount1} ${item1} and ${amount2} ${item2}. If the library buys ${amount1 * 4} more ${item1}, what is the ratio if the number of ${item2} remains the same?`;
            answer = `${amount1 * 4 + amount1}:${amount2}`;
            break;
          
          case 3: //?
            question = `A kitchen uses ${food1} and ${food2} in a ratio of ${amount1}:${amount2}. If the total usage is ${amount1 * casenum + amount2 * casenum}, how many ${food1} are used?`;
            answer = `${amount1 * casenum}`;
            break;
          case 4:
            question = `${randomChoice === 1 ? "Simplify the ratio of" : "Write the ratio in reduced form of"} ${amount1 * 2}:${amount2 * 2} for ${item1} to ${item2}.`;
            answer = simplifyRatio(amount1 * 2, amount2 * 2);
            break;
          case 5:
            question = `If the ratio of ${item1} to ${item2} is ${amount1}:${amount2}, how many ${item1} are there if there are ${amount2 * 3} ${item2}?`;
            answer = `${amount1 * 3}`;
            break;
          
          case 6:
            question = `What is the ratio of ${amount1 * 2} ${item1} to ${amount2 * 4} ${item2}?<br>Simplify the ratio.`;
            answer = simplifyRatio(amount1 * 2, amount2 * 4);
            break;
          case 7:

            question = `If ${item1} and ${item2} are in the ratio ${amount1}:${amount2} and there are ${(amount1 + amount2)*casenum} items in total, how many ${item1} are there?`;
            answer = `${amount1*casenum}`;
            break;
          case 8:
            question = `What is the ratio of ${item1} to ${item2} if the numbers are ${amount1 * 3} ${item1} and ${amount2 * 3} ${item2}, and it needs to be simplified?`;
            answer = simplifyRatio(amount1 * 3, amount2 * 3);
            break;
          case 9:
            question = `If ${amount1} ${item1} weigh the same as ${amount2} ${item2}, what is the weight ratio of ${item2} to ${item1}?`;
            answer = `${amount2}:${amount1}`;
            break;
          case 10:
            question = `A garden has ${randomChoice === 1 ? `${food1} and ${food2}` : `${plant1} and ${plant2}`} planted in a ratio of ${amount1}:${amount2}. If there are ${(amount1 + amount2)*casenum} plants in total, how many are 
            ${randomChoice === 1 ? `${food1}` : `${plant1}`}`;
            answer = `${amount1*casenum}`; // Assuming a simple distribution where item1 gets half of the 20 additional
            break;
          case 11:
            question = `The lengths of ${item1} and ${item2} are in the ratio of ${amount1}:${amount2}. If the length of ${item1} is ${amount1 * 5} cm, what is the length of ${item2}?`;
            answer = `${amount2 * 5} cm`;
            break;
          case 12:
            question = `The school has ${amount1} ${item1} and ${amount2} ${item2}. If the school buys ${amount1 * 4} more ${item1}, what is the ratio if the number of ${item2} remains the same?`;
            answer = `${amount1 * 4 + amount1}:${amount2}`;
            break;
          case 13:
            question = `Compare ${amount1 * 10} ${item1} to ${amount2 * 5} ${item2} in a ratio and simplify it.`;
            answer = simplifyRatio(amount1 * 10, amount2 * 5);
            break;
          case 14:
            question = `A bus transports ${item1} and ${item2} in a ratio of ${amount1}:${amount2}. How many ${item2} are there if the total number on the bus is ${(amount1 + amount2) * casenum}?`;
            answer = `${amount2 * casenum}`;
            break;
          case 15:
            question = `In a race, the ratio of ${vehicle1} finishing to ${vehicle2} is ${amount1}:${amount2}. If ${amount1 * 2} ${vehicle1} finish the race, how many ${vehicle2} finish?`;
            answer = `${amount2 * 2}`;
            break;
          case 16:
            question = `A dining set includes ${utensil1} and ${utensil2} in the ratio ${amount1}:${amount2}. If there are ${amount2 * 5} ${utensil2}, how many ${utensil1} must there be to maintain the ratio?`;
            answer = `${amount1 * 5}`;
            break;
          case 17:
            if (amount1 >= amount2) {
              question = `If ${item1} to ${item2} has a ratio of ${amount1}:${amount2} and the total is ${amount1 * casenum + amount2 * casenum} items, find how many more ${item1} there are than ${item2}.`;
              answer = `${(amount1 - amount2) * casenum}`;
            } else {
              question = `If ${item2} to ${item1} has a ratio of ${amount2}:${amount1} and the total is ${amount1 * casenum + amount2 * casenum} items, find how many more ${item2} there are than ${item1}.`;
              answer = `${(amount2 - amount1) * casenum}`;
            }
            break;
          case 18:
            question = `A kitchen uses ${food1} and ${food2} in a ratio of ${amount1}:${amount2}. If the total usage is ${amount1 * casenum + amount2 * casenum}, how many ${food1} are used?`;
            answer = `${amount1 * casenum}`;
            break;
          // Case 21: Part-to-Whole with Three Items
case 19:
    const totalAmount = amount1 + amount2 + amount3; // Calculate total of all three items

    // Randomly decide if the question will be part-to-whole or part-to-part
    const isPartToWhole = Math.random() < 0.5; // 50% chance for each type

    if (isPartToWhole) {
        // Part-to-Whole: Select one item to compare to the total
        const selectedItemIndex = Math.floor(Math.random() * 3); // 0 for item1, 1 for item2, 2 for item3
        const selectedItem = selectedItemIndex === 0 ? item1 : selectedItemIndex === 1 ? item2 : item3;
        const selectedAmount = selectedItemIndex === 0 ? amount1 : selectedItemIndex === 1 ? amount2 : amount3;

        question = `There are ${amount1} ${item1}, ${amount2} ${item2}, and ${amount3} ${item3}. What is the ratio of ${selectedItem} to the total number of items?`;
        answer = `${selectedAmount}:${totalAmount}`; // Ratio of selected item to total amount

    } else {
        // Part-to-Part: Compare two items, excluding the third
        const firstItemIndex = Math.floor(Math.random() * 3);
        let secondItemIndex;
        do {
            secondItemIndex = Math.floor(Math.random() * 3);
        } while (secondItemIndex === firstItemIndex);

        const firstItem = [item1, item2, item3][firstItemIndex];
        const secondItem = [item1, item2, item3][secondItemIndex];
        const firstAmount = [amount1, amount2, amount3][firstItemIndex];
        const secondAmount = [amount1, amount2, amount3][secondItemIndex];

        question = `There are ${amount1} ${item1}, ${amount2} ${item2}, and ${amount3} ${item3}. What is the ratio of ${firstItem} to ${secondItem}?`;
        answer = `${firstAmount}:${secondAmount}`; // Ratio of two selected items
    }
    break;
        }

        const hint = `Remember to simplify ratios where necessary and convert units if required. The answer here is: ${answer}`;

        const validateFn = (userInput) => {
          const standardizedInput = userInput.replace(/\s+/g, '').toLowerCase();
          const standardizedAnswer = answer.toString().replace(/\s+/g, '').toLowerCase();
          const isCorrect = standardizedInput === standardizedAnswer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "6uwnkOC5hLI",
  "LFB29oT7Zd0",);
      }
      function generateSolveRatioTableProblem() {
        // Generate random numbers for the ratio table
        let num1, num2, num3, num4, num5
        do {
          num1 = Math.floor(Math.random() * 9) + 2
          num2 = Math.floor(Math.random() * 9) + 2
          num3 = Math.floor(Math.random() * 9) + 2
          num4 = Math.floor(Math.random() * 9) + 2
          num5 = Math.floor(Math.random() * 9) + 2
        } while (new Set([num1, num2, num3, num4, num5]).size !== 5) // Ensure all numbers are unique

        // Fill in the first column with the generated numbers
        let column1 = [num1 * num3, num2 * num3]

        // Calculate the values for the top spot in columns 2 and 3
        let bottomSpotCol2 = num2 * num4
        let topSpotCol3 = num1 * num5

        const question = `
  <style>
      table {
          border-collapse: collapse;
      }
      table, th, td {
          border: 1px solid black;
          padding: 8px;
          text-align: center;
      }
  </style>
  <table>
      <tr>
          <th>Column 1</th>
          <th>Column 2</th>
          <th>Column 3</th>
      </tr>
      <tr>
          <td>${column1[0]}</td>
          <td></td>
          <td>${topSpotCol3}</td>
      </tr>
      <tr>
          <td>${column1[1]}</td>
          <td>${bottomSpotCol2}</td>
          <td></td>
      </tr>
  </table>
  <br>`

        const answer = `${num1 * num4}, ${num2 * num5}` // Provide the correct answer in the format "column2,column3"
        //foobar
        const hint = `
         <style>
table {
          border-collapse: collapse;
      }
      table, th, td {
          border: 1px solid black;
          padding: 8px;
          text-align: center;
      }
  </style>
  <table>
     
      <tr>
    <th>Simple<br>Ratio</th>
    <th><span style="text-decoration: underline;">Column 1</span> <br>simple &bull;${num3}</th>
    <th><span style="text-decoration: underline;">Column 2</span><br>simple &bull;${num4}</th>
    <th><span style="text-decoration: underline;">Column 3</span><br>simple &bull;${num5}</th>
</tr>

      <tr>
    <td>${num1}</td>
    <td>${column1[0]}</td>
    <td>${num1} &bull; ${num4} = <strong style="font-size: 110%;">${num1 * num4}</strong></td>
    <td>${topSpotCol3}</td>
</tr>
      <tr>
          <td>${num2}</td>
          <td>${column1[1]}</td>
          <td>${bottomSpotCol2}</td>
           <td>${num2} &bull; ${num5} = <strong style="font-size: 110%;">${num2 * num5}</strong></td>
      </tr>
  </table>
        
        
        
        <table border="1" cellpadding="5">
    <tr>
        <br><td colspan="3">Hint: Treat the columns as equivalent fractions</td>
    </tr>
    <tr>
        <td>Step</td>
        <td>Column 1</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            <span class="frac"><sup>${column1[0]}</sup><span>&frasl;</span><sub>${column1[1]}</sub></span> = <span class="frac"><sup>${num1}</sup><span>&frasl;</span><sub>${num2}</sub></span>
        </td>
        <td>
            Simplify the ratio in the first column.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            <span class="frac"><sup>${num1} &bull; ${num4}</sup><span>&frasl;</span><sub>${num2} &bull; ${num4}</sub></span> =  <span class="frac"><sup>${num1 * num4}</sup><span>&frasl;</span><sub>${num2 * num4}</sub></span>
        </td>
        <td>
            Use the simplified fraction to make an equivalent fraction for column 2
            <br>column 2 answer = ${num2 * num4}
            
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            <span class="frac"><sup>${num1} &bull; ${num5}</sup><span>&frasl;</span><sub>${num2} &bull; ${num5}</sub></span> =  <span class="frac"><sup>${num1 * num5}</sup><span>&frasl;</span><sub>${num2 * num5}</sub></span>
        </td>
        <td>
            Use the simplified fraction to make an equivalent fraction for column 3
            <br>column 3 answer = ${num2 * num5}
            
            
        </td>
    </tr>
</table><br>

`

        const validateFn = (userInput) => {
          const [col2Answer, col3Answer] = userInput
            .split(",")
            .map((val) => val.trim())
          const isCorrect =
            col2Answer == num1 * num4 && col3Answer == num2 * num5
          displayHintAndFeedback(isCorrect, hint)
          return isCorrect
        }

        // Explicitly set the placeholders and display the second input field
        const userAnswer = document.getElementById("userAnswer")
        const extraInput = document.getElementById("extraInput")

        userAnswer.placeholder = "Column 2 answer"
        userAnswer.style.display = "block"

        extraInput.placeholder = "Column 3 answer"
        extraInput.style.display = "block"

        return new Problem(question, answer, validateFn, hint, true,
  "6uwnkOC5hLI",
  "LFB29oT7Zd0",)
      }
      function generateUnitRateProblem() {
      
      const foodItems = ['apple', 'banana', 'tomato', 'potato', 'carrot', 'onion', 'lettuce', 'cucumber', 'pepper', 'mushroom', 'grape', 'orange', 'lemon', 'blueberry', 'strawberry'];
const animals = ['dog', 'cat', 'horse', 'cow', 'chicken', 'pig', 'sheep', 'goat', 'rabbit', 'duck', 'goose', 'llama', 'alpaca', 'turkey', 'deer'];
const stationary = ['pen', 'pencil', 'book', 'notebook', 'marker', 'eraser', 'ruler', 'stapler', 'paper clip', 'scissors', 'tape', 'glue stick', 'highlighter', 'folder', 'binder'];
const vehicles = ['car', 'bicycle', 'motorcycle', 'truck', 'bus', 'van', 'scooter', 'moped', 'tractor', 'golf cart', 'ATV', 'snowmobile', 'jet ski', 'camper', 'trailer'];
const plants = ['tree', 'flower', 'shrub', 'fern', 'cactus', 'succulent', 'vine', 'grass', 'bamboo', 'palm', 'orchid', 'lily', 'rose', 'tulip', 'daisy'];

const utensils = ['fork', 'spoon', 'plate', 'cup', 'serving spoon', 'ladle', 'tong', 'whisk', 'spatula', 'measuring cup', 'measuring spoon', 'mixing bowl', 'cutting board', 'cheese grater', 'peeler', 'garlic press', 'can opener', 'bottle opener', 'ice cream scoop', 'salad spinner', 'colander'];
const distance = ['mile', 'yard', 'meter', 'inch', 'centimeter', 'millimeter', 'kilometer', 'nautical mile', 'parsec', 'furlong', 'rod', 'fathom', 'league', 'cubit', 'astronomical unit', 'light-year'];
const volume = ['teaspoon', 'tablespoon', 'fluid ounce', 'cup', 'pint', 'quart', 'gallon', 'milliliter', 'liter', 'cubic centimeter', 'cubic meter', 'cubic inch', 'cubic yard'];




        function pickTwoItems(items) {
          let index1 = Math.floor(Math.random() * items.length);
          let index2;
          do {
            index2 = Math.floor(Math.random() * items.length);
          } while (index1 === index2);
          return [items[index1], items[index2]];
        }

        // Generate two items for each category
        const [food1, food2] = pickTwoItems(foodItems);
        const [animal1, animal2] = pickTwoItems(animals);
        const [stationary1, stationary2] = pickTwoItems(stationary);
        const [vehicle1, vehicle2] = pickTwoItems(vehicles);
        const [plant1, plant2] = pickTwoItems(plants);
        const [utensil1, utensil2] = pickTwoItems(utensils);
        const [distance1, distance2] = pickTwoItems(distance);
        const [volume1, volume2] = pickTwoItems(volume);
        

        const allItems = [foodItems, animals, stationary, vehicles, plants, utensils];

        function pickTwoItemsFromSameList() {
          // Randomly select one list from the array of lists
          const selectedList = allItems[Math.floor(Math.random() * allItems.length)];
          // Pick two different items from the selected list
          let index1 = Math.floor(Math.random() * selectedList.length);
          let index2;
          do {
            index2 = Math.floor(Math.random() * selectedList.length);
          } while (index1 === index2);
          return [selectedList[index1], selectedList[index2]];
        }

        // Generate two generic items from the same, randomly selected, list
        const [item1, item2] = pickTwoItemsFromSameList();
        const randomChoice = Math.floor(Math.random() * 2) + 1;

        // Example of using these variables in a ratio problem
        const amount1 = Math.floor(Math.random() * 10) + 2;
        const amount2 = Math.floor(Math.random() * 10) + 2;

        
        const casenum = Math.floor(Math.random() * 10) + 2;
        function getRandomInt(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Random number generator for costs and quantities
        function getRandomCost(min, max) {
          return (Math.random() * (max - min) + min).toFixed(2);
        }

        const type = getRandomInt(2, 2); // Choose a type of question randomly
        let question, answer;

        switch (type) {
          case 1:
            const quantity1 = getRandomInt(5, 15);
            const quantity2 = getRandomInt(3, 10);
            const totalCost1 = getRandomCost(1, 10);
            const unitPrice1 = (totalCost1 / quantity1).toFixed(2);
            question = `How many ${food1} can you buy for $${quantity2} if ${quantity1} ${food1} cost $${totalCost1}?`;

            answer = `${Math.floor(quantity2 / unitPrice1)}`;

            break;
          case 2:
            const miles = getRandomInt(100, 500);
            const gallons = getRandomInt(5, 25);
            question = `If a ${vehicle1} travels ${miles} ${distance1}s on ${gallons} ${volume1}s of gasoline, how many ${distance1}s per ${volume1} does the ${vehicle1} get?<br>Round your answer to the hundredths`;
            answer = `${(miles / gallons).toFixed(2)}`;
            break;
          case 3:
            const totalMiles = getRandomInt(10, 50);
            const hours = getRandomInt(2, 10);
            question = `A runner completes ${totalMiles} miles in ${hours} hours. What is the runner's average speed in miles per hour?<br>Round your answer to the nearest tenth`;
            answer = `${(totalMiles / hours).toFixed(1)}`;
            break;

            // Continue similarly for other cases
          case 4:
            const gramsOfFlour = getRandomInt(100, 1000);
            const pricePer100g = getRandomCost(0.5, 2);
            const totalFlourCost = ((gramsOfFlour / 100) * pricePer100g).toFixed(2);
            question = `A recipe calls for ${gramsOfFlour} grams of flour, which costs $${pricePer100g} per 100 grams. How much does the flour cost in total?<br>Round your answer to the nearest hundredth`;
            answer = `$${totalFlourCost}`;
            break;

          case 5:
            const cupsSugar = getRandomInt(2, 10);
            const numCookies = getRandomInt(20, 100);
            question = `If ${cupsSugar} cups of sugar are used to make ${numCookies} cookies, how much sugar is used per cookie?<br>Round your answer to the nearest hundredth`;
            answer = `${(cupsSugar / numCookies).toFixed(2)}`;
            break;
          case 6:
            const totalBeats = getRandomInt(1000, 2000);
            const timeMinutes = getRandomInt(15, 30);
            question = `A person's heart beats ${totalBeats} times in ${timeMinutes} minutes. What is the heartbeat rate per minute?`;
            answer = `${(totalBeats / timeMinutes).toFixed(2)} beats per minute`;
            break;
          case 7:
            const milesTraveled = getRandomInt(200, 600);
            const dieselGallons = getRandomInt(10, 50);
            question = `A truck uses ${dieselGallons} gallons of diesel to travel ${milesTraveled} miles. What is its fuel efficiency in miles per gallon?`;
            answer = `${(milesTraveled / dieselGallons).toFixed(2)} miles per gallon`;
            break;
          case 8:
            const totalRibbon = getRandomInt(100, 300);
            const numBows = getRandomInt(10, 50);
            question = `If ${totalRibbon} feet of ribbon makes ${numBows} bows, how much ribbon is needed per bow?`;
            answer = `${(totalRibbon / numBows).toFixed(2)} feet per bow`;
            break;
          case 9:
            const totalMarkers = getRandomInt(10, 50);
            const costMarkers = getRandomCost(5, 25);
            question = `${totalMarkers} markers cost $${costMarkers}. What is the cost per marker?`;
            answer = `$${(costMarkers / totalMarkers).toFixed(2)} per marker`;
            break;
          case 10:
            const pagesRead = getRandomInt(100, 500);
            const daysToRead = getRandomInt(1, 7);
            question = `If a student reads ${pagesRead} pages in ${daysToRead} days, how many pages does the student read per day?`;
            answer = `${(pagesRead / daysToRead).toFixed(2)} pages per day`;
            break;
          case 11:
            const minutesPracticed = getRandomInt(100, 500);
            const practiceDays = getRandomInt(1, 7);
            question = `A musician practices for ${minutesPracticed} minutes over ${practiceDays} days. How many minutes does the musician practice daily?`;
            answer = `${(minutesPracticed / practiceDays).toFixed(2)} minutes per day`;
            break;
          case 12:
            const fabricMeters = getRandomInt(10, 30);
            const fabricCost = getRandomCost(50, 150);
            question = `${fabricMeters} meters of fabric cost $${fabricCost}. What is the cost per meter?`;
            answer = `$${(fabricCost / fabricMeters).toFixed(2)} per meter`;
            break;
          case 13:
            const gadgetsProduced = getRandomInt(400, 1000);
            const productionHours = getRandomInt(1, 10);
            question = `A factory produces ${gadgetsProduced} gadgets in ${productionHours} hours. What is the production rate per hour?`;
            answer = `${(gadgetsProduced / productionHours).toFixed(2)} gadgets per hour`;
            break;
          case 14:
            const cargoKilograms = getRandomInt(200, 500);
            const anotherCargoGrams = getRandomInt(100000, 500000);
            question = `Convert the weight of ${cargoKilograms} kilograms of cargo to grams. Then, compare it to ${anotherCargoGrams} grams of another cargo in a ratio.`;
            answer = `1:${(anotherCargoGrams / (cargoKilograms * 1000)).toFixed(3)}`;
            break;
          case 15:
            const numOranges = getRandomInt(100, 500);
            const numApples = getRandomInt(100, 500);
            question = `There are ${numOranges} oranges and ${numApples} apples. What is the simplified ratio of oranges to apples?`;
            answer = `${numOranges}:${numApples}`;
            break;
          case 16:
            const cats = getRandomInt(5, 20);
            const dogs = Math.round(cats * 5 / 3); // Ratio of cats to dogs is 3:5
            question = `If the ratio of cats to dogs is 3:5 and there are ${cats} cats, how many dogs are there?`;
            answer = `${dogs} dogs`;
            break;
          case 17:
            const totalPlants = getRandomInt(50, 100);
            const tulips = Math.round(totalPlants / 5);
            question = `In a garden, there are 4 times as many roses as tulips. If there are ${totalPlants} plants in total, how many are tulips?`;
            answer = `${tulips} tulips`;
            break;
          case 18:
            const partWeightKg = getRandomInt(1, 10);
            const anotherPartWeightGrams = partWeightKg * getRandomInt(100, 1000);
            question = `A machine part weighs ${partWeightKg} kilograms, and another weighs ${anotherPartWeightGrams} grams. What is the ratio of their weights?`;
            answer = `1:${(anotherPartWeightGrams / (partWeightKg * 1000)).toFixed(3)}`;
            break;
          case 19:
            const pencils = getRandomInt(5, 20);
            const pencilsCost = getRandomCost(1, 10);
            question = `If ${pencils} pencils cost $${pencilsCost}, what is the cost per pencil?`;
            answer = `$${(pencilsCost / pencils).toFixed(2)} per pencil`;
            break;
          case 20:
            const notebooks = getRandomInt(10, 30);
            const notebookCost = 3; // constant price per notebook
            const totalNotebookCost = notebooks * notebookCost;
            question = `Calculate the total cost of buying ${notebooks} notebooks if each costs $${notebookCost}.`;
            answer = `$${totalNotebookCost}`;
            break;
        }

        const hint = `Remember to use unit rates and conversions appropriately to solve the question. ${answer}`;

        const validateFn = (userInput) => {
          // Remove all non-numeric and non-decimal characters, then parse as float
          const standardizedInput = parseFloat(userInput.replace(/[^0-9.]/g, ''));
          const standardizedAnswer = parseFloat(answer.replace(/[^0-9.]/g, ''));

          // Compare the numerical values
          const isCorrect = standardizedInput === standardizedAnswer;

          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return {
          question,
          answer,
          validate: validateFn,
          hint
        };
      }
      
      //Equations//
      function generateTranslationProblem() {
        const num1 = Math.floor(Math.random() * 50) + 5; // Generate a random number between 5 and 54
        const num2 = Math.floor(Math.random() * 50) + 5; // Generate a random number between 5 and 54
        const questionType = Math.floor(Math.random() * 15) + 1; // Randomly choose the type of problem

        let question, answer, answer2, hint;

        switch (questionType) {
          case 1: // Addition
            question = `The sum of a number and ${num1} is ${num2}.  <br> Use n as the variable`;
            answer = `n + ${num1} = ${num2}`;
            answer2 = `${num1} + n = ${num2}`;

            break;
          case 2: // Subtraction
            question = `${num1} more than a number is ${num2}.  <br> Use n as the variable`;
            answer = `n + ${num1} = ${num2}`;
            answer2 = `${num1} + n  = ${num2}`;

            break;
          case 3: // Multiplication
            question = `Increasing a number by ${num1} gives ${num2}.  <br> Use n as the variable`;
            answer = `n + ${num1} = ${num2}`;
            answer2 = `${num1} + n  = ${num2}`;

            break;
          case 4: // Addition
            question = `${num1} added to a number equals ${num2}.  <br> Use n as the variable`;
            answer = `n + ${num1} = ${num2}`;
            answer2 = `${num1} + n  = ${num2}`;

            break;
          case 5: // Subtraction
            question = `${num1} less than a number equals ${num2}.  <br> Use n as the variable`;
            answer = `n - ${num1} = ${num2}`;

            break;
          case 6: // Multiplication
            question = `The difference between a number and ${num1} is ${num2}.  <br> Use n as the variable`;
            answer = `n - ${num1} = ${num2}`;

            break;
          case 7: // Addition
            question = `Subtracting ${num1} from a number leaves ${num2}.  <br> Use n as the variable`;
            answer = `n - ${num1} = ${num2}`;

            break;
          case 8: // Subtraction
            question = `${num1} subtracted from a number results in ${num2}.  <br> Use n as the variable`;
            answer = `n - ${num1} = ${num2}`;

            break;
          case 9: // Multiplication
            question = `The product of a number and ${num1} gives ${num2}.  <br> Use n as the variable`;
            answer = `${num1}n = ${num2}`;
            answer2 = `n${num1} = ${num2}`;

            break;
          case 10: // Addition
            question = `${num1} times a number is ${num2}.  <br> Use n as the variable`;
            answer = `${num1}n = ${num2}`;
            answer2 = `n${num1} = ${num2}`;

            break;
          case 11: // Subtraction
            question = `Dividing a number by ${num1} is ${num2}.  <br> Use n as the variable`;
            answer = `n / ${num1} = ${num2}`;

            break;
          case 12: // Multiplication
            question = `When a number is divided by ${num1}, the result is ${num2}.  <br> Use n as the variable`;
            answer = `n / ${num1} = ${num2}`;

            break;
          case 13: // Subtraction
            question = `${num1} divided by a number equals ${num2}.  <br> Use n as the variable`;
            answer = `${num1} / n = ${num2}`;

            break;
          case 14: // Multiplication
            question = `${num1} divided by ${num2} = n.  <br> Use n as the variable`;
            answer = `${num1} / ${num2} = n`;

            break;
          case 15: // Division
            question = `A number n divided by ${num1} = ${num2}.  <br> Use n as the variable`;
            answer = `n / ${num1} = ${num2}`;

            break;
        }
        // Validation function
        hint = answer
        const validateFn = (userInput) => {
          const normalizedUserInput = userInput.replace(/\s+/g, '').toLowerCase();
          const normalizedCorrectAnswer1 = answer.replace(/\s+/g, '').toLowerCase();
          let isCorrect = normalizedUserInput === normalizedCorrectAnswer1;

          // Check if the first answer format is incorrect and if there's a second answer format
          if (!isCorrect && answer2) {
            const normalizedCorrectAnswer2 = answer2.replace(/\s+/g, '').toLowerCase();
            isCorrect = normalizedUserInput === normalizedCorrectAnswer2;
          }

          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        // Assuming Problem is a constructor for your problem objects
        return new Problem(question, answer, validateFn, hint,false,"o_Ubm7OI8t4");
      }
      function generateUnknownProblem() {
        let num1, num2, num3, question, answer, hint;
        const type = Math.floor(Math.random() * 4) + 1; // Choose a random type between 1 and 4

        switch (type) {
          case 1:
            num1 = Math.floor(Math.random() * 9) + 2; // Random number for multiplication
            num2 = Math.floor(Math.random() * 9) + 2;
            num3 = Math.floor(Math.random() * 9) + 2; // Random number for addition
            question = `${num3} x ${num1+num2} = ${num3} x (${num2} + _________)`;
            answer = num1.toString(); // Calculate the missing number
            break;
          case 2:
            num1 = Math.floor(Math.random() * 9) + 2;
            num2 = Math.floor(Math.random() * 9) + 2;
            num3 = Math.floor(Math.random() * 9) + 2;
            question = `${num3} x ${num1+num2} = (${num3} x ${num2}) + (${num3} x _______)`;
            answer = num1.toString();
            break;
          case 3:
            num1 = Math.floor(Math.random() * 9) + 2;
            num2 = Math.floor(Math.random() * 9) + 2;
            num3 = Math.floor(Math.random() * 9) + 2;
            question = `${num3} x (${num1} + ${num2}) = ${num3} x _________`;
            answer = (num1 + num2).toString();
            break;
          case 4:
            num1 = Math.floor(Math.random() * 9) + 2;
            num2 = Math.floor(Math.random() * 6) + 2;
            num3 = Math.floor(Math.random() * 6) + 2;
            question = `${num1} x (${num2} + ${num3}) = _________`;
            answer = (num1 * (num2 + num3)).toString();
            break;
        }

        // Generate hints based on the type of question
        hint = generateHintForUnknownType(type, num1, num2, num3);

        const validateFn = (userInput) => {
          const isCorrect = userInput.trim() === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint);
      }
      // Function to generate hints based on question type
      function generateHintForUnknownType(type, num1, num2, num3) {
        let hint = "";
        switch (type) {
          case 1:
            hint += `${num3} x ${num1+num2} = ${num3} x (${num2} + _________)<br>
            
            Balance the sides:<br> Both sides have ${num3} x <br> First side is ${num3} x ${num1 +num2}<br> Second side is ${num3} x (${num2} + _________)<br> ${num1 +num2} needs to equal ${num1 +num2}<br>, you need to multiply by the same number  ${num1+num2} = (${num2} + _________)  `;
            break;
          case 2:
            hint += `${num3} x ${num1+num2} = (${num3} x ${num2}) + (${num3} x _______)First, calculate ${num3} x ${num2} to find part of the total. `;
            hint += `Then subtract this from the total (${num3} x ${num1+num2}) to find the missing part. `;
            hint += `This missing part divided by ${num3} is the missing number.`;
            break;
          case 3:
            hint += `${num3} x (${num1} + ${num2}) = ${num3} x _________To solve, you divide the total (${num3} x (${num1} + ${num2})) by ${num3}. `;
            hint += `This tells you the combined total of ${num1} and ${num2} before multiplying by ${num3}.`;
            break;
          case 4:
            hint += `${num1} x (${num2} + ${num3}) = _________(${num2} + ${num3}) = ${num2 + num3} add first since it's in parentheses. <br>`;
            hint += `Then, multiply ${num2 + num3} × ${num1} to find the total. `;
            break;
        }
        return hint;
      }
      function generateFactorProblem() {
        let num1, num2, num3, question, answer, hint;
        const isFactoring = Math.random() < 0.5; // Randomly decide between factoring and distributing

        if (isFactoring) {
          // Factoring problem
          num3 = Math.floor(Math.random() * 3) + 2;
          num1 = num3 * (Math.floor(Math.random() * 20) + 2);
          num2 = num3 * (Math.floor(Math.random() * 20) + 2);
          const commonFactor = calculateGCF(num1, num2);

          // Determine whether to add or subtract
          const isAddition = Math.random() < 0.5;

          // Create the expression accordingly
          const sign = isAddition ? '+' : '-';

          question = `Factor: ${num1}n ${sign} ${num2}`;
          answer = `${commonFactor}( ${num1 / commonFactor}n ${isAddition ? '+' : '-'} ${num2 / commonFactor} )`;

          hint = `Practice GCF question first:
                 
                
 <table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${num1}n ${sign} ${num2}
        </td>
        <td>
            Original expression
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            GCF: ${commonFactor}
        </td>
        <td>
            Identify the Greatest Common Factor (GCF)
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            ${commonFactor}&bull;${num1 / commonFactor}n ${sign} ${commonFactor}&bull;${num2 / commonFactor}
        </td>
        <td>
            Pull the GCF out of each term
        </td>
    </tr>
    <tr>
        <td>4</td>
        <td>
            ${commonFactor}(${num1 / commonFactor}n ${sign} ${num2 / commonFactor})
        </td>
        <td>
            Place the GCF outside the parentheses
        </td>
    </tr>
</table>


 `;
        } else {
          // Distributing problem, similar setup as factoring but phrased differently
          num3 = Math.floor(Math.random() * 3) + 2;
          num1 = num3 * (Math.floor(Math.random() * 20) + 2);
          num2 = num3 * (Math.floor(Math.random() * 20) + 2);
          const commonFactor = calculateGCF(num1, num2);
          const isAddition = Math.random() < 0.5;

          // Create the expression accordingly
          const sign = isAddition ? '+' : '-';

          question = `Use the GCF to simplify: ${num1} ${sign} ${num2}`;
          answer = `${commonFactor}( ${num1 / commonFactor} ${isAddition ? '+' : '-'} ${num2 / commonFactor} )`;
          hint = `Practice GCF question first:
   
   <table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${num1} ${sign} ${num2}
        </td>
        <td>
            Original expression
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            GCF: ${commonFactor}
        </td>
        <td>
            Identify the Greatest Common Factor (GCF)
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            ${commonFactor}&bull;${num1 / commonFactor} ${sign} ${commonFactor}&bull;${num2 / commonFactor}
        </td>
        <td>
            Pull the GCF out of each term
        </td>
    </tr>
    <tr>
        <td>4</td>
        <td>
            ${commonFactor}(${num1 / commonFactor} ${sign} ${num2 / commonFactor})
        </td>
        <td>
            Place the GCF outside the parentheses
        </td>
    </tr>
</table>
   `;
        }

        const validateFn = (userInput) => {
          const standardizedInput = userInput.replace(/\s+/g, '').toLowerCase();
          const normalizedCorrectAnswer = answer.replace(/\s+/g, '').toLowerCase();
          const isCorrect = standardizedInput === normalizedCorrectAnswer || standardizedInput === answer.toLowerCase();
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "-y0-vf0zsMg",
  "",);
      }
      function generateSubstituteProblem() {
        const num1 = Math.floor(Math.random() * 9) + 1;
        const num2 = Math.floor(Math.random() * 9) + 1;
        const num3 = Math.floor(Math.random() * 9) + 1;
        const operation = Math.random() < 0.5 ? '+' : '-';

        const question = `Solve for x: ${num1}x ${operation} ${num3} <br>Given that x = ${num2}.`;
        const answer = operation === '+' ? (num1 * num2 + num3) : (num1 * num2 - num3);

        const hint = `
          
          <table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
             ${num1}x ${operation} ${num3} = <br>
             ${num1}(${num2}) ${operation} ${num3}
        </td>
        <td>
            Substitute x with ${num2} into the equation
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
             ${num1}(${num2}) ${operation} ${num3} = <br>
             ${num1}&bull;${num2} ${operation} ${num3} = <br>
             ${num1 * num2} ${operation} ${num3}
        </td>
        <td>
            Perform the multiplication:
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
             ${operation === '+' ? num1 * num2 + ' + ' + num3 : num1 * num2 + ' - ' + num3} = ${answer}.
        </td>
        <td>
            Complete the ${operation === '+' ? 'addition' : 'subtraction'}:
        </td>
    </tr>
</table>
`;

        // Ensure validateFn uses the standardized way of handling input and comparing with the answer
        const validateFn = (userInput) => {
          const parsedInput = parseFloat(userInput);
          const isCorrect = parsedInput === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer.toString(), validateFn, hint, false,
  "DOKiZfX9ePk",
  "",);
      }
      function generateDistributeProblem() {
        const coefficient = Math.floor(Math.random() * 5) + 2; // Coefficient between 2 and 6
        const term1 = Math.floor(Math.random() * 10) + 1;
        const term2 = Math.floor(Math.random() * 10) + 1;
        const question = `${coefficient}(${term1}n - ${term2})`;
        const answer = `${coefficient * term1}n - ${coefficient * term2}`;
        const hint = `To distribute, multiply the number outside the parentheses by each term inside the parentheses: ` +
          `
          
          <table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${coefficient}(${term1}n-${term2}) = <br>
            ${coefficient}&bull;${term1}n - ${coefficient}&bull;${term2}
        </td>
        <td>
            Multiply (${coefficient}) by the terms (${term1}n) and (${term2}) inside the parentheses
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            ${coefficient}&bull;${term1}n - ${coefficient}&bull;${term2} = <br>
            ${coefficient * term1}n - ${coefficient * term2}
        </td>
        <td>
            Perform the multiplication
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            ${coefficient * term1}n - ${coefficient * term2}
        </td>
        <td>
            Remember to keep the sign
        </td>
    </tr>
</table>
`;

        const validateFn = (userInput) => {
          const standardizedInput = userInput.trim().replace(/\s+/g, '');
          // Simplify the input answer to compare with simplified correct answer
          const simplifiedInput = standardizedInput.replace(/n/g, ''); // Remove 'n' for numerical comparison
          const simplifiedAnswer = answer.replace(/n/g, ''); // Remove 'n' from the correct answer for comparison
          const isCorrect = eval(simplifiedInput) === eval(simplifiedAnswer); // Evaluate expressions for numerical comparison
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "CTw40jSAUx0",
  "",);
      }
      function generateSolveForXProblem() {
        let question, answer, hint, num2;
        const questionType = Math.floor(Math.random() * 6) + 1; // Choose a problem type at random

        switch (questionType) {
          case 1: // Simple addition, e.g., x + 3 = 10
            const addNum = Math.floor(Math.random() * 10) + 1;
            answer = Math.floor(Math.random() * 10) + 1;
            question = `x + ${addNum} = ${answer + addNum}`;
            hint = `Subtract ${addNum} from both sides of the equation to solve for x.<br>
            x = ${answer}`;
            break;
          case 2: // Simple subtraction, e.g., x - 2 = 5
            const subNum = Math.floor(Math.random() * 10) + 1;
            answer = Math.floor(Math.random() * 10) + 1;
            question = `x - ${subNum} = ${answer - subNum}`;
            hint = `Add ${subNum} to both sides of the equation to solve for x. <br>
            x = ${answer}`;
            break;
          case 3: // Simple multiplication, e.g., 3x = 15
            const multNum = Math.floor(Math.random() * 10) + 1;
            answer = Math.floor(Math.random() * 10) + 1;
            question = `${multNum}x = ${answer * multNum}`;
            hint = `Divide both sides by ${multNum} to solve for x.
            <br>x = ${answer}`;
            break;
          case 4: // Simple division, e.g., x/4 = 2
            const divNum = Math.floor(Math.random() * 10) + 1;
            num2 = Math.floor(Math.random() * 10) + 1;
            answer = num2 * divNum
            question = `x / ${divNum} = ${num2}`;
            hint = `Multiply both sides by ${divNum} to solve for x.
            <br>x = ${answer}`;
            break;
          case 5: // Mixed operations with addition and multiplication
            const addMixNum = Math.floor(Math.random() * 10) + 1;
            const multMixNum = Math.floor(Math.random() * 5) + 2;
            answer = Math.floor(Math.random() * 10) + 1;
            question = `${multMixNum}(x + ${addMixNum}) = ${multMixNum * (answer + addMixNum)}`;
            hint = `First, divide both sides by ${multMixNum}, then subtract ${addMixNum} from both sides to solve for x.
            <br>x = ${answer}`;
            break;
          case 6: // Mixed operations with subtraction and division
            const subMixNum = Math.floor(Math.random() * 10) + 1;
            const divMixNum = Math.floor(Math.random() * 5) + 2;
            num2 = Math.floor(Math.random() * 10) + 1;
            answer = num2 * divMixNum + subMixNum
            question = `<span class="frac"><sup>(x - ${subMixNum})</sup><span>&frasl;</span><sub>${divMixNum}</sub></span> = ${num2}`;
            hint = `First, multiply both sides by ${divMixNum}, then add ${subMixNum} to both sides to solve for x.
            <br>x = ${answer}`;
            break;
        }

        // Adjust the validateFn to properly compare the user's input against the correct answer
        const validateFn = (userInput) => {
          const parsedInput = parseFloat(userInput);
          const isCorrect = parsedInput === answer; // Ensure comparison is correct
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer.toString(), validateFn, hint, false,
  "L0_K89UJfJY",
  "",);
      } 
      function generateExponentProblem() {
        let num1 = Math.floor(Math.random() * 8) + 2; // Base between 2 and 9
        let exponent;
        if (num1 > 5) {
          exponent = Math.floor(Math.random() * 3) + 2; // Exponent between 2 and 4
        } else {
          exponent = Math.floor(Math.random() * 4) + 2; // Exponent between 2 and 5
        }

        let multiplicationSequence = `${num1}`;
        for (let i = 1; i < exponent; i++) {
          multiplicationSequence += ` × ${num1}`;
        }

        const question = `Calculate ${num1}<sup>${exponent}</sup>`;
        const answer = Math.pow(num1, exponent);
        const hint = `
          <table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${num1}<sup>${exponent}</sup>
        </td>
        <td>
            Calculate ${num1}<sup>${exponent}</sup> using exponentiation
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            Base: ${num1}<br>Exponent: ${exponent}
        </td>
        <td>
            Display base and exponent
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            ${multiplicationSequence} = ${answer}
        </td>
        <td>
            Multiply the base ${num1} by itself ${exponent} times
        </td>
    </tr>
</table>

          `;

        // Ensure validateFn handles user input correctly
        const validateFn = (userInput) => {
          const parsedInput = parseFloat(userInput);
          const isCorrect = parsedInput === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer.toString(), validateFn, hint, false,
  "NS4vHqJIPiE",
  "",);
      }
      function generateExponent2Problem() {
        let base, exponent, answer, hint;
        const wasFraction = Math.random() < 0.5;

        if (wasFraction) {
          let numerator = Math.floor(Math.random() * 8) + 1;
          let denominator = Math.floor(Math.random() * (8 - numerator)) + numerator + 1;

          // Find the GCD of numerator and denominator using the Euclidean algorithm
          let a = numerator;
          let b = denominator;
          while (b !== 0) {
            let temp = b;
            b = a % b;
            a = temp;
          }
          let gcd = a;
          exponent = Math.floor(Math.random() * 3) + 2;
          base = `(<span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span>)`;
          let hintbase = `(<span class="frac"><sup>${numerator/gcd}</sup><span>&frasl;</span><sub>${denominator/gcd}</sub></span>)`;

          // Use math.js to handle the exponentiation and simplification of the fraction
          let fraction = math.pow(math.fraction(numerator, denominator), exponent);
          answer = math.format(fraction, {
            fraction: 'ratio'
          });



          gcd; // this should be assigned based on your specific calculation
          hint = ""; // Initialize 'hint' as an empty string
          var steps = []; // Array to hold steps dynamically

          // Append initial message and change step order if gcd is not 1
          if (gcd !== 1) {
            // This will become the first step if gcd is not 1
            steps.push(`
        <tr>
            <td>1</td>
            <td>Simplify the fraction. <br> ${base} = ${hintbase}</td>
            <td>If possible, simplify the fraction by finding the greatest common divisor (GCD) between the numerator and denominator</td>
        </tr>
    `);
          }

          // Add standard steps which adjust based on whether the initial step was added
          steps.push(`
    <tr>
        <td>${steps.length + 1}</td>
        <td>${hintbase}<sup>${exponent}</sup></td>
        <td>Calculate ${hintbase}<sup>${exponent}</sup> using exponentiation</td>
    </tr>
`);
          steps.push(`
    <tr>
        <td>${steps.length + 1}</td>
        <td>${Array.from({length: exponent}, () => hintbase).join(' * ')}</td>
        <td>Multiply ${hintbase} by itself ${exponent} times</td>
    </tr>
`);
          steps.push(`
    <tr>
        <td>${steps.length + 1}</td>
        <td>Answer: ${answer}</td>
        <td>Simplify the fraction if possible</td>
    </tr>
`);

          // Build the full hint content including the dynamic steps
          hint += `
    <table border="1" cellpadding="5">
        <tr>
            <td colspan="2">Step</td>
            <td>Explanation</td>
        </tr>
        ${steps.join('')}  
    </table>
`;

          // 'hint' now contains the complete table with dynamically ordered steps

        } else {
          const countDecimals = (num) => {
            if (Math.floor(num) === num) return 0;
            return num.toString().split(".")[1].length || 0;
          };

          base = (Math.floor(Math.random() * 20) + 1) * 0.01;
          exponent = Math.floor(Math.random() * 3) + 2;

          // Count decimals in base
          const decimalCount = countDecimals(base);

          // Perform exponentiation without math.js
          let result = 1;
          for (let i = 0; i < exponent; i++) {
            result *= base;
          }

          // Format the result
          answer = result.toFixed(decimalCount * exponent);

          hint = `
    <table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${base}<sup>${exponent}</sup>
        </td>
        <td>
            Calculate ${base}<sup>${exponent}</sup> using exponentiation
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            ${Array(exponent).fill(base).join(' * ')}
        </td>
        <td>
            Multiply ${base} by itself ${exponent} times
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td>
            Answer: ${answer}
        </td>
        <td>
            Display the result of the calculation
        </td>
    </tr>
    
</table>

    `;
        }

        const question = `Calculate ${base}<sup>${exponent}</sup>, keeping the answer as a fraction if the base is a fraction.`;

        const validateFn = (userInput) => {
          const isCorrect = userInput.trim() === answer;
          displayHintAndFeedback(isCorrect, hint); // This function should handle hint display and feedback
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint, false,
  "Xa95eZ9fCrQ",
  "MP3viJTn-e4",);
      }
      function generateWriteEquationProblem() {
        const input1 = Math.floor(Math.random() * 9) + 2;
        const operation1 = Math.floor(Math.random() * 3); // 0 for addition, 1 for subtraction, 2 for multiplication
        const stepValue = Math.floor(Math.random() * 10) + 1;

        let output1, output2, output3;
        if (operation1 === 0) { // Addition
          output1 = input1 + stepValue;
          output2 = input1 * 2 + stepValue;
          output3 = input1 * 3 + stepValue;
        } else if (operation1 === 1) { // Subtraction
          output1 = input1 - stepValue;
          output2 = input1 * 2 - stepValue;
          output3 = input1 * 3 - stepValue;
        } else { // Multiplication
          output1 = stepValue;
          output2 = 2 * stepValue;
          output3 = 3 * stepValue;
        }

        let equation;
        if (operation1 === 0 || operation1 === 1) {
          equation = `${input1}n ${operation1 === 0 ? '+' : '-'} ${stepValue} = y`;
        } else {
          equation = `${stepValue}n = y`;
        }

        const question = `
  <style>
      table {
          border-collapse: collapse;
      }
      table, th, td {
          border: 1px solid black;
          padding: 8px;
          text-align: center;
      }
  </style>
  <table>
      <tr>
          <th>n</th>
          <th>  &nbsp; Rule &nbsp;  </th>
          <th>y</th>
      </tr>
      <tr>
          <td>1</td>
          <td></td>
          <td>${output1}</td>
      </tr>
      <tr>
          <td>2</td>
          <td></td>
          <td>${output2}</td>
      </tr>
      <tr>
          <td>3</td>
          <td></td>
          <td>${output3}</td>
      </tr>
  </table>
  Write an equation`;

        const hint = `To solve, decide how y is changing per change in n.<br>
  ${output2} - (${output1}) = ${output2-output1}     This is the change per n<br>
  ${output2-output1}n                 Times the change per n <br>
  ${equation}`;

        const validateFn = (userInput) => {
          // Trim and standardize input for comparison
          const standardizedInput = userInput.replace(/\s+/g, '').toLowerCase();
          const standardizedAnswer = equation.replace(/\s+/g, '').toLowerCase();

          const isCorrect = standardizedInput === standardizedAnswer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, equation, validateFn, hint, false,
  "Xa95eZ9fCrQ",
  "MP3viJTn-e4",);
      }

      //Rational//
      function generateAbsoluteValueProblem() {
        let num = Math.floor(Math.random() * 21) - 10; // Number between -10 and 10
        let isNegated = Math.random() < 0.5; // Randomly decide whether to negate

        const question = `What is ${isNegated ? '-' : ''}|${num}|?`;
        const answer = isNegated ? -Math.abs(num) : Math.abs(num);
        let hint = "The absolute value of a number is its distance from 0 on the number line, regardless of direction.<br><br>";

        if (isNegated) {
          hint += `1. The question shows -|${num}|, which means we take the negative of the absolute value of ${num}.<br>`;
          hint += `2. The absolute value of ${num} is ${Math.abs(num)}, because it's ${Math.abs(num)} units away from 0 on the number line.<br>`;
          hint += `3. Since we're taking the negative of the absolute value, the answer is -${Math.abs(num)}.`;
        } else {
          hint += `1. The question shows |${num}|, which is asking for the absolute value of ${num}.<br>`;
          hint += `2. The absolute value of ${num} is ${Math.abs(num)}, because it's ${Math.abs(num)} units away from 0 on the number line, without considering direction.<br>`;
          hint += `3. So, the answer is ${Math.abs(num)}, which is the absolute distance from 0.`;
        }

        // Validation function to handle user input
        const validateFn = (userInput) => {
          const parsedInput = parseFloat(userInput);
          const isCorrect = parsedInput === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer.toString(), validateFn, hint, false,
  "LnfhdtjcpVY",
  "",);
      }
      function generateOppositesProblem() {
        let num = Math.floor(Math.random() * 21) - 10; // Number between -10 and 10
        let questionType = Math.random() < 0.5 ? 'opposite' : 'opposite of the opposite';
        let hint = "";

        if (questionType === 'opposite') {
          hint += `The opposite of a number is the same distance from 0 on the number line, but in the opposite direction. `;
          hint += `So, the opposite of ${num} is ${-num}.`;
        } else {
          // Opposite of the opposite
          hint += `First, find the opposite of ${num}, which is ${-num}. <br>`;
          hint += `Then, to find the opposite of the opposite, you just go back to the original number. <br>`;
          hint += `Think of it as taking two steps in one direction and then two steps back to where you started. <br>`;
          hint += `So, the opposite of the opposite of ${num} is back to ${num} itself.`;
        }

        const question = `What is the ${questionType === 'opposite' ? 'opposite' : 'opposite of the opposite'} of ${num}?`;
        const answer = questionType === 'opposite' ? -num : num;

        // Validation function to handle user input
        const validateFn = (userInput) => {
          const parsedInput = parseFloat(userInput);
          const isCorrect = parsedInput === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer.toString(), validateFn, hint, false,
  "CqUt_b-aZhM",
  "",);
      }
      function generateLCMProblem() {
        let num1 = Math.floor(Math.random() * 10) + 2;
        let num2 = Math.floor(Math.random() * 11) + 2;

        while (num1 === num2) {
          num2 = Math.floor(Math.random() * 11) + 2;
        }

        let lcm = calculateLCM(num1, num2);


        let multiplesOfNum1 = [];
        let multiplesOfNum2 = [];
        let index = 1;
        // Keep generating multiples until both have reached the LCM
        while (!multiplesOfNum1.includes(lcm) || !multiplesOfNum2.includes(lcm)) {
          let multiple1 = num1 * index;
          let multiple2 = num2 * index;

          if (multiple1 <= lcm || multiplesOfNum1.length < 5) { // Ensure at least 5 multiples or up to LCM
            multiplesOfNum1.push(multiple1);
          }
          if (multiple2 <= lcm || multiplesOfNum2.length < 5) { // Ensure at least 5 multiples or up to LCM
            multiplesOfNum2.push(multiple2);
          }

          index++;
        }

        // Construct the hint
        let hint = `
    <p>To find the LCM of ${num1} and ${num2}, list the multiples of each number.</p>
    <table border="1" cellpadding="5">
        <tr>
            <td colspan="2">Step</td>
            <td>Explanation</td>
        </tr>
        <tr>
            <td>1</td>
            <td>
                Multiples of ${num1}: ${multiplesOfNum1.join(", ")}
            </td>
            <td>
                List all multiples of ${num1} up to a certain limit or until the LCM is found.
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>
                Multiples of ${num2}: ${multiplesOfNum2.join(", ")}
            </td>
            <td>
                List all multiples of ${num2} up to a certain limit or until the LCM is found.
            </td>
        </tr>
        <tr>
            <td>3</td>
            <td>
                LCM: ${lcm}
            </td>
            <td>
                The smallest number that is a multiple of both ${num1} and ${num2} is their LCM.
            </td>
        </tr>
    </table>
`;


        const validateFn = (userInput) => {
          const parsedInput = parseInt(userInput, 10);
          const isCorrect = parsedInput === lcm;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(`Find the LCM of ${num1} and ${num2}`, lcm.toString(), validateFn, hint, false,
  "53Ed5yjBELc",
  "L6n0ZkwueOM",);
      }
      
      
      
      
     function generateGCFProblem() {
    const primes = [2, 3, 5, 7, 11];

    // Helper function to calculate the GCF
    const calculateGCF = (a, b) => {
        while (b !== 0) {
            [a, b] = [b, a % b];
        }
        return a;
    };

    let numA, numB, gcf, patternChoice;
    let attempts = 0;

    // Decide whether to use the original or random number pattern
    patternChoice = Math.random() < 1 / 3 ? "random" : "factorized";

    if (patternChoice === "random") {
        // Pattern 1: Two random numbers between 10 and 80
        do {
            numA = Math.floor(Math.random() * 31) + 10; // Random number between 10 and 80
            numB = Math.floor(Math.random() * 71) + 10; // Random number between 10 and 80
        } while (numA === numB); // Ensure the numbers are not the same
        gcf = calculateGCF(numA, numB); // Calculate the GCF
    } else {
        // Pattern 2: Prime factorization-based generation
        do {
            attempts++;

            // Generate random numbers
            const num1 = Math.floor(Math.random() * 8) + 2;
            const num2 = Math.floor(Math.random() * 8) + 1;
            const num3 = Math.floor(Math.random() * 5) + 1;
            const num4 = num3 + 1;

            numA = num1 * num2 * num3;
            numB = num1 * num2 * num4;

            // Calculate the initial GCF
            gcf = calculateGCF(numA, numB);

            // Adjust numB if GCF can be derived by subtraction
            while (Math.abs(numB - numA) === gcf && numB <= 100) {
                numB += gcf; // Modify the larger number by adding the GCF
                gcf = calculateGCF(numA, numB); // Recalculate GCF
            }

            // Exit if attempts exceed a threshold
            if (attempts > 10) {
                break;
            }
        } while (numA > 100 || numB > 100 || gcf === 1);
    }

    const originalNumA = numA; // Store original values
    const originalNumB = numB;

    // Generate the hint for both patterns
   const hint = (() => {
    let steps = [];
    let remainingA = numA;
    let remainingB = numB;
    let divisor = 2; // Start checking from the smallest prime factor
    const divisors = []; // Keep track of all divisors

    // Factor both numbers step-by-step
    while (divisor <= Math.min(remainingA, remainingB)) {
        if (remainingA % divisor === 0 && remainingB % divisor === 0) {
            divisors.push(divisor); // Add the divisor to the list
            steps.push({
                divisor,
                factorA: remainingA / divisor,
                factorB: remainingB / divisor,
            });
            remainingA /= divisor;
            remainingB /= divisor;
        } else {
            divisor++;
        }
    }

    // Construct the hint HTML
    let hintHTML = `
    <p>Find the Greatest Common Factor (GCF) of the numbers by determining common factors.</p>
    <table border="1" cellpadding="5">
        <tr>
            <td>Step</td>
            <td>Calculation</td>
            <td>Explanation</td>
        </tr>`;

    steps.forEach((step, index) => {
        hintHTML += `
        <tr>
            <td>${index + 1}</td>
            <td>
                ${numA} ÷ ${step.divisor} = ${step.factorA}<br>
                ${numB} ÷ ${step.divisor} = ${step.factorB}
            </td>
            <td>
                Divide both numbers by ${step.divisor}, a common factor.
            </td>
        </tr>`;
        numA = step.factorA; // Update factored-down values
        numB = step.factorB;
    });

    // Add the final step with divisors and multiplication
    hintHTML += `
    <tr>
        <td>${steps.length + 1}</td>
        <td>
            Remaining numbers: ${remainingA}, ${remainingB}
        </td>
        <td>
            No further common factors exist. The divisors were: ${divisors.join(" × ")}.<br>
            Multiply these to find the GCF: ${divisors.join(" × ")} = ${gcf}.
        </td>
    </tr>
    <tr>
        <td>Final</td>
        <td>
            GCF = ${gcf}
        </td>
        <td>
            The Greatest Common Factor of the original numbers is ${gcf}.
        </td>
    </tr>
    </table>
    `;
    return hintHTML;
})();


    const validateFn = (userInput) => {
        const parsedInput = parseInt(userInput, 10); // Parse the user input as an integer
        const isCorrect = parsedInput === gcf; // Compare parsed input with the calculated GCF

        if (isCorrect) {
            displayHintAndFeedback(true, "Correct! Well done."); // Show positive feedback
        } else {
            displayHintAndFeedback(false, `Incorrect. The correct answer is ${gcf}. Review the hint: ${hint}`); // Show hint and correct answer
        }

        return isCorrect;
    };

    return new Problem(
        `Find the GCF of ${originalNumA} and ${originalNumB}`, // Use the stored original numbers
        gcf.toString(),
        validateFn,
        hint,
        false,
        "LDx95tyBtQ8",
        "",
    );
}




      function generateCompareIntegersProblem() {
        // Generate random integers for comparison
        const num1 = Math.floor(Math.random() * 100) - 50 // Random integer between -50 and 49
        const num2 = Math.floor(Math.random() * 100) - 50 // Random integer between -50 and 49

        // Set the question and the correct answer based on the comparison
        const question = `Compare the following numbers: ${num1} ___ ${num2}`
        let answer
        if (num1 < num2) answer = "<"
        else if (num1 === num2) answer = "="
        else answer = ">"

        // Generate a hint to guide the student
        const hint = `Use <, >, or = to compare the two numbers. The correct answer is ${answer}.`

        // Show comparison buttons for this problem
        document.getElementById("conditionalButtons").style.display = "block"
        document.getElementById("lessThanButton").style.display = "inline-block"
        document.getElementById("equalsButton").style.display = "inline-block"
        document.getElementById("greaterThanButton").style.display =
          "inline-block"

        // Hide irrelevant buttons
        document.getElementById("trueButton").style.display = "none"
        document.getElementById("falseButton").style.display = "none"

        // Hide the input box for this problem
        document.getElementById("userAnswer").style.display = "none"

        // Validate function to check if the student's answer matches the correct answer
        const validateFn = (userInput) => {
          console.log("User Input (trimmed):", userInput.trim()) // Log user input
          console.log("Expected Answer:", answer.trim()) // Log the expected answer
          const isCorrect = userInput.trim() === answer.trim() // Compare trimmed values
          console.log("Is Correct:", isCorrect) // Log if the comparison is correct
          displayHintAndFeedback(isCorrect, hint) // Pass result to feedback function
          return isCorrect // Return the result
        }

        // Return a new Problem instance
        return new Problem(
          question,
          answer,
          validateFn,
          hint,
          false, // No second input needed
          "BgrRG3sMHRE", // Teaching video ID
          "w6LfGwslhlw", // Example video ID
        )
      }
      //Statistics//
      function generateMeanProblem() {
        const numbersForMean = Array.from({
          length: 5 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);
        const mean = numbersForMean.reduce((a, b) => a + b, 0) / numbersForMean.length;

        const hint = `To find the mean (average) of a set of numbers:<br>` +
          `1. Add all the numbers together.<br>` +
          `2. Divide the total by the number of items in the set.<br>` +
          `For example, for these numbers: ${numbersForMean.join(', ')},<br>` +
          `1. Total = ${numbersForMean.reduce((a, b) => a + b, 0)}.<br>` +
          `2. Number of items = ${numbersForMean.length}.<br>` +
          `3. Mean is the Total / Number of items: ${numbersForMean.reduce((a, b) => a + b, 0)} / ${numbersForMean.length} = ${mean}.`;

        const validateFn = (userInput) => {
          const userAnswer = parseFloat(userInput).toFixed(2);
          const correctAnswer = mean.toFixed(2);
          const isCorrect = userAnswer === correctAnswer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        const question = `Find the mean of these numbers: ${numbersForMean.join(', ')}. Round your answer to the nearest hundredth.`;
        const answer = mean.toFixed(2);

        return new Problem(question, answer, validateFn, hint, false,
  "H7u0Zrra060",
  "",);
      }
      function generateMedianProblem() {
        // Generate a set of numbers
        const numbersForMedian = Array.from({
          length: 5 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);

        // Sort the numbers to calculate the median, but do not change the original array
        const sortedNumbers = [...numbersForMedian].sort((a, b) => a - b);
        const isEven = sortedNumbers.length % 2 === 0;
        const midIndex = Math.floor(sortedNumbers.length / 2);
        const median = isEven ?
          (sortedNumbers[midIndex - 1] + sortedNumbers[midIndex]) / 2 :
          sortedNumbers[midIndex];

        // Constructing the hint with detailed steps
        const hint = `To find the median:<br>` +
          `1. Arrange the numbers in ascending order. For example, sort the numbers:<br>` +
          `&nbsp;&nbsp;&nbsp;Unsorted: ${numbersForMedian.join(', ')}<br>` +
          `&nbsp;&nbsp;&nbsp;Sorted: ${sortedNumbers.join(', ')}<br>` +
          `2. If there's an odd number of items, the median is the middle number.<br>` +
          `3. If there's an even number of items, the median is the average of the two middle numbers.<br>` +
          `4. This set is ${isEven ? 'even' : 'odd'}, so ${isEven ? `average the two middle numbers (${sortedNumbers[midIndex - 1]} and ${sortedNumbers[midIndex]})` : `the middle number is ${sortedNumbers[midIndex]}`}.<br>` +
          `5. ${isEven ? `(${sortedNumbers[midIndex - 1]} + ${sortedNumbers[midIndex]}) / 2 = ${median}` : `The median is ${median}`}.`;

        const validateFn = (userInput) => {
          const userAnswer = parseFloat(userInput);
          const isCorrect = numbersForMedian.length % 2 !== 0 ? userAnswer === median : userAnswer.toFixed(2) === median.toFixed(2);
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        const question = `Find the median of these numbers: ${numbersForMedian.join(', ')}.`;
        const answer = median.toFixed(2);

        return new Problem(question, answer, validateFn, hint, false,
  "Y7M_KNwIZvw",
  "",);
      }
      function generateModeProblem() {
        let numbersForMode = Array.from({
          length: 5 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);
        let frequency = {};
        let maxFreq = 0;
        let mode = [];

        // Calculate the frequency of each number
        numbersForMode.forEach((num) => {
          frequency[num] = (frequency[num] || 0) + 1;
          if (frequency[num] > maxFreq) {
            maxFreq = frequency[num];
          }
        });

        // Determine the mode(s)
        for (const num in frequency) {
          if (frequency[num] === maxFreq) {
            mode.push(num);
          }
        }

        // Check if all numbers have the same frequency
        const allSameFrequency = Object.values(frequency).every(freq => freq === maxFreq);
        if (allSameFrequency && mode.length === Object.keys(frequency).length) {
          mode = []; // If every number appears the same number of times, there is no mode
        }

        mode.sort((a, b) => a - b); // Sort the mode array numerically

        const hint = `To find the mode, determine which number(s) appear most frequently. If no number appears more frequently than others, there is no mode.`;

        const validateFn = (userInput) => {
          const userAnswers = userInput.split(',').map(num => num.trim()).sort();
          const correctAnswers = mode.length ? mode.map(String).sort() : ['none'];
          const isCorrect = userAnswers.length === correctAnswers.length && userAnswers.every((value, index) => value === correctAnswers[index]);
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        const question = `Find the mode of these numbers: ${numbersForMode.join(', ')}. If there is no mode, type 'none'.`;
        const answer = mode.length ? mode.join(', ') : 'none';

        return new Problem(question, answer, validateFn, hint, false,
  "xObCUytIVMo",
  "",);
      }
      function generateRangeProblem() {
        const numbersForRange = Array.from({
          length: 5 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);
        const minNum = Math.min(...numbersForRange);
        const maxNum = Math.max(...numbersForRange);
        const range = maxNum - minNum;

        const hint = `To find the range, identify the smallest and largest numbers in the set.<br>` +
          `For your numbers: ${numbersForRange.join(', ')},<br>` +
          `The smallest number is ${minNum}, and the largest number is ${maxNum}.<br>` +
          `Subtract the smallest number from the largest number to find the range: ${maxNum} - ${minNum} = ${range}.`;

        const validateFn = (userInput) => {
          const userAnswer = parseInt(userInput, 10);
          const isCorrect = userAnswer === range;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        const question = `Find the range of these numbers: ${numbersForRange.join(', ')}.`;
        const answer = range.toString();

        return new Problem(question, answer, validateFn, hint, false,
  "vp1wqtfGJuk",
  "",);
      }
      function generateFirstQuartileProblem() {
        // Generate the numbers for the quartile calculation without sorting them initially
        const numbersForQ1 = Array.from({
          length: 7 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);

        // Create a copy of the numbers and sort it for calculations
        const sortedNumbersForQ1 = [...numbersForQ1].sort((a, b) => a - b);

        // Calculate the index for Q1 in the sorted array
        const q1Index = Math.floor((sortedNumbersForQ1.length - 1) / 4);
        const q1 = sortedNumbersForQ1[q1Index];

        // Generate the hint using the sorted array
        const hint = `To find the first quartile (Q1), first arrange the numbers in ascending order. ` +
          `Then divide the dataset into four equal parts. ` +
          `Q1 is the median of the first half of the dataset.<br>` +
          `For your numbers (sorted): ${sortedNumbersForQ1.join(', ')},<br>` +
          `Q1 is the value at the ${(Math.floor(sortedNumbersForQ1.length / 4) + 1)}th position when sorted, ` +
          `which is ${q1}.`;

        const validateFn = (userInput) => {
          const userAnswer = parseFloat(userInput);
          const isCorrect = userAnswer === q1;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        // Present the question with the numbers in their original, unsorted form
        const question = `Find the first quartile (Q1) of these numbers: ${numbersForQ1.join(', ')}.`;
        const answer = q1.toString();

        // Assuming Problem is a constructor or a factory for creating problem instances
        return new Problem(question, answer, validateFn, hint, false,
  "oPw2OpIZ4DY",
  "",);
      }
      function generateThirdQuartileProblem() {
        // Generate the numbers for the quartile calculation without sorting them initially
        const numbersForQ3 = Array.from({
          length: 7 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);

        // Create a copy of the numbers and sort it for calculations
        const sortedNumbersForQ3 = [...numbersForQ3].sort((a, b) => a - b);

        // Calculate the index for Q3 in the sorted array
        const q3Index = Math.ceil(3 * (sortedNumbersForQ3.length - 1) / 4);
        const q3 = sortedNumbersForQ3[q3Index];

        // Generate the hint using the sorted array
        const hint = `To find the third quartile (Q3), first arrange the numbers in ascending order. ` +
          `Then divide the dataset into four equal parts. ` +
          `Q3 is the median of the second half of the dataset.<br>` +
          `For your numbers (sorted): ${sortedNumbersForQ3.join(', ')},<br>` +
          `Q3 is the value at the ${q3Index + 1}th position (in a sorted list), which is ${q3}.`;

        const validateFn = (userInput) => {
          const userAnswer = parseFloat(userInput);
          const isCorrect = userAnswer === q3;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        // Present the question with the numbers in their original, unsorted form
        const question = `Find the third quartile (Q3) of these numbers: ${numbersForQ3.join(', ')}.`;
        const answer = q3.toString();

        // Assuming Problem is a constructor or a factory for creating problem instances
        return new Problem(question, answer, validateFn, hint, false,
  "oPw2OpIZ4DY",
  "",);
      }
      function generateInterquartileRangeProblem() {
        // Generate the numbers for the IQR calculation without sorting them initially
        const numbersForIQR = Array.from({
          length: 7 + Math.floor(Math.random() * 5)
        }, () => Math.floor(Math.random() * 20) + 1);

        // Create a copy of the numbers and sort it for calculations
        const sortedNumbersForIQR = [...numbersForIQR].sort((a, b) => a - b);

        // Calculate the indices and values for Q1 and Q3 in the sorted array
        const q1Index = Math.floor((sortedNumbersForIQR.length - 1) / 4);
        const q3Index = Math.ceil(3 * (sortedNumbersForIQR.length - 1) / 4);
        const q1 = sortedNumbersForIQR[q1Index];
        const q3 = sortedNumbersForIQR[q3Index];
        const iqr = q3 - q1;

        // Generate the detailed hint
        const hint = `The interquartile range (IQR) is the difference between the third quartile (Q3) and the first quartile (Q1). ` +
          `First, arrange the numbers in ascending order. ` +
          `For your numbers (sorted): ${sortedNumbersForIQR.join(', ')},<br>` +
          `Q1 is located at the ${(q1Index + 1)}th position and Q3 at the ${(q3Index + 1)}th position in the sorted list. ` +
          `Thus, IQR = Q3 - Q1 = ${q3} - ${q1} = ${iqr}.`;

        const validateFn = (userInput) => {
          const userAnswer = parseFloat(userInput);
          const isCorrect = userAnswer === iqr;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        // Present the question with the numbers in their original, unsorted form
        const question = `Calculate the interquartile range (IQR) of these numbers: ${numbersForIQR.join(', ')}.`;
        const answer = iqr.toString();

        // Assuming Problem is a constructor or a factory for creating problem instances
        return new Problem(question, answer, validateFn, hint,false,"VABsJBw1JqA");
      }

      //Reveal//
      // sort function start
      
      
      function generateConvertHarderQuestion() {
        const convertToFraction = Math.random() < 0.5;
        let question, answer, answerType, hint;

        if (convertToFraction) {
          const decimal = parseFloat((Math.random()).toFixed(2));
          const placeValue = decimal.toString().split('.')[1].length;
          const denominator = Math.pow(10, placeValue);
          const numerator = Math.round(decimal * denominator);
          const simplified = simplifyFraction(numerator, denominator);
          question = `Convert ${decimal} to a fraction`;
          answer = `${simplified.numerator}/${simplified.denominator}`;
          answerType = 'fraction';
          // Modified hint to format the answer in the question style
          hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td>
            ${decimal} = <span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span>
        </td>
        <td>
        Recognize that the farthest digit in ${decimal} is in the ${denominator === 100 ? 'hundredths' : 'tenths'} place.
            
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td>
            <span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span> = <span class="frac"><sup>${simplified.numerator}</sup><span>&frasl;</span><sub>${simplified.denominator}</sub></span>
        </td>
        <td>
            Simplify the fraction if possible.
        </td>
    </tr>
</table>`;
        } else {
          const denominator = Math.floor(Math.random() * 9) + 2; // Ensure denominator is not 1
          const numerator = Math.floor(Math.random() * (denominator - 1)) + 1; // Ensure numerator is less than denominator
          question = `Convert <span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span> to a decimal, round your answer to the hundredths place`;
          answer = (numerator / denominator).toFixed(2);
          answerType = 'decimal';

          // Create a temporary variable for display in the hint
          let displayAnswer = answer;

          // Check if the displayAnswer starts with '0.' and remove the '0' if present
          if (displayAnswer.startsWith('0.')) {
            displayAnswer = displayAnswer.slice(1);
          }
          hint = `<table border="1" cellpadding="5">
    <tr>
        <td colspan="2">Step</td>
        <td>Explanation</td>
    </tr>
    <tr>
        <td>1</td>
        <td style="text-align: center;">
            <span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span>
        </td>
        <td>
            Start by writing the fraction you want to convert.
        </td>
    </tr>
    <tr>
        <td>2</td>
        <td style="text-align: center;">
            ${numerator} ÷ ${denominator}
        </td>
        <td>
            Divide the numerator (${numerator}) by the denominator (${denominator}) to convert the fraction to a decimal.
        </td>
    </tr>
    <tr>
        <td>3</td>
        <td style="text-align: center;">
            ${answer}
        </td>
        <td>
            The decimal result is ${answer}. This is the decimal form of the fraction.
        </td>
    </tr>
    <tr>
        <td>4</td>
        <td style="text-align: center;">
            <table style="border-collapse: collapse; margin: auto;">
                <tr>
                    <td style="text-align: right; padding-right: 10px;">&nbsp;</td>
                    <td style="text-align: right;">0</td>
                    <td style="text-align: left;">${displayAnswer}</td>
                </tr>
                <tr>
                    <td style="border-right: 1px solid black;">${denominator}</td>
                    <td style="border-top: 1px solid black;">${numerator}</td>
                </tr>
            </table>
        </td>
        <td>
            Here is a visual representation of the division process. The numerator is placed under the division bar and divided by the denominator to get the decimal output displayed.
        </td>
    </tr>
</table>`;

        }

        // Validation function to compare user input with the answer
        const validateFn = (userInput) => {
          const isCorrect = answerType === 'decimal' ? parseFloat(userInput).toFixed(2) === answer : userInput.trim() === answer;
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, answer, validateFn, hint);
      }
     function generateConvertQuestion() {
    const inputType = Math.floor(Math.random() * 3); // 0: fraction, 1: decimal, 2: percent
    let question, givenValue, answerFraction, originalFraction, answerDecimal, answerPercent, hint;

    // Function to calculate the GCD (Greatest Common Divisor)
    function gcd(a, b) {
        return b === 0 ? a : gcd(b, a % b);
    }

    // Generate a random fraction
    const possibleDenominators = [2, 5, 10, 20, 25, 50, 100];
    const denominator = possibleDenominators[Math.floor(Math.random() * possibleDenominators.length)];
    const numerator = Math.floor(Math.random() * (denominator - 1)) + 1;

    // Simplify the fraction
    const divisor = gcd(numerator, denominator);
    const simplifiedNumerator = numerator / divisor;
    const simplifiedDenominator = denominator / divisor;

    // Calculate decimal and percentage
    const rawDecimal = numerator / denominator;
    const decimalValue = rawDecimal.toFixed(2).replace(/\.?0+$/, '');
    const percentValue = (rawDecimal * 100).toFixed(2).replace(/\.?0+$/, '') + '%';

    // Derive unsimplified fractions based on input type
    if (inputType === 1) {
        // Decimal to Fraction
        const decimalDenominator = Math.pow(10, decimalValue.split('.')[1]?.length || 0); // Denominator based on decimal places
        const decimalNumerator = Math.round(decimalValue * decimalDenominator);
        originalFraction = `${decimalNumerator}/${decimalDenominator}`;
        const fractionGCD = gcd(decimalNumerator, decimalDenominator);
        answerFraction = `${decimalNumerator / fractionGCD}/${decimalDenominator / fractionGCD}`;
    } else if (inputType === 2) {
        // Percentage to Fraction
        const percentNumerator = parseFloat(percentValue.replace('%', ''));
        const percentDenominator = 100;
        originalFraction = `${percentNumerator}/${percentDenominator}`;
        const fractionGCD = gcd(percentNumerator, percentDenominator);
        answerFraction = `${percentNumerator / fractionGCD}/${percentDenominator / fractionGCD}`;
    } else {
        // Fraction already provided
        originalFraction = `${numerator}/${denominator}`;
        answerFraction = `${simplifiedNumerator}/${simplifiedDenominator}`;
    }

    // Store answers
    answerDecimal = decimalValue;
    answerPercent = percentValue;

    // Generate the question based on inputType
    if (inputType === 0) {
        givenValue = `<span class="frac"><sup>${numerator}</sup><span>&frasl;</span><sub>${denominator}</sub></span>`;
        question = `Convert the fraction ${givenValue} to its decimal and percentage forms.`;
    } else if (inputType === 1) {
        givenValue = decimalValue;
        question = `Convert the decimal ${givenValue} to its fraction and percentage forms.`;
    } else {
        givenValue = percentValue;
        question = `Convert the percentage ${givenValue} to its fraction and decimal forms.`;
    }

    // Hint table including unsimplified and simplified fractions
    hint = `
        <table border="1" cellpadding="5">
            
            <tr>
                <td>Fraction</td>
                <td>
                    <span class="frac"><sup>${originalFraction.split('/')[0]}</sup><span>&frasl;</span><sub>${originalFraction.split('/')[1]}</sub></span> = <span class="frac"><sup>${answerFraction.split('/')[0]}</sup><span>&frasl;</span><sub>${answerFraction.split('/')[1]}</sub></span>
                </td>
            </tr>
            <tr>
                <td>Decimal</td>
                <td>${decimalValue}</td>
            </tr>
            <tr>
                <td>Percentage</td>
                <td>${percentValue}</td>
            </tr>
        </table>
    `;

    // Validation function (unchanged)
    const validateFn = (userInput) => {
        const inputs = userInput.split(',').map((val) => val.trim());
        const [firstAnswer, secondAnswer] = inputs;
        let isCorrectDecimal = false;
        let isCorrectPercent = false;

        if (inputType === 0) {
            isCorrectDecimal = firstAnswer === answerDecimal;
            isCorrectPercent = secondAnswer.replace(/\.?0+$/, '') === answerPercent.replace(/\.?0+$/, '');
        } else if (inputType === 1) {
            isCorrectPercent = secondAnswer.replace(/\.?0+$/, '') === answerPercent.replace(/\.?0+$/, '');
            isCorrectDecimal = firstAnswer === answerFraction;
        } else if (inputType === 2) {
            isCorrectDecimal = secondAnswer === answerDecimal;
            isCorrectPercent = firstAnswer === answerFraction;
        }

        const isOverallCorrect = isCorrectDecimal && isCorrectPercent;
        displayHintAndFeedback(isOverallCorrect, hint);

        return isOverallCorrect;
    };

    // Configure user input fields
    const userAnswer = document.getElementById("userAnswer");
    const extraInput = document.getElementById("extraInput");

    if (inputType === 0) {
        userAnswer.placeholder = "Enter the decimal form";
        extraInput.placeholder = "Enter the percentage form";
    } else if (inputType === 1) {
        userAnswer.placeholder = "Enter the fraction form";
        extraInput.placeholder = "Enter the percentage form";
    } else {
        userAnswer.placeholder = "Enter the fraction form";
        extraInput.placeholder = "Enter the decimal form";
    }

    userAnswer.style.display = "block";
    extraInput.style.display = "block";

    return new Problem(
        question,
        `${answerFraction}, ${answerDecimal}, ${answerPercent}`, // Expected answers
        validateFn,
        hint,
        true // Two inputs required
    );
}








      
      //Area
      function generateTriangleProblem() {
        const base1 = Math.floor(Math.random() * (15 - 5 + 1)) + 5; // Generates a random base length between 5 and 15
        const base2 = base1 / 2; // Generates a random base length between 5 and 15
        const height = Math.floor(Math.random() * (12 - 4 + 1)) + 4; // Generates a random height between 4 and 12
        const area = 0.5 * base1 * height; // Formula for the area of a triangle

        document.getElementById('top-dimension').innerText = ``;
        document.getElementById('bottom-dimension').innerText = `${base1} units`;
        document.getElementById('height-dimension').innerText = `${height} units`;

        adjustTrapezoidDimensions(base1, base2, height);

        const question = `Given a triangle with base length of ${base1} units and height of ${height} units, calculate the area of the triangle.`;
        const answer = 0.5 * base1 * height; // Formula for the area of a triangle
        const hint = `The formula for the area of a triangle is (base * height) / 2. Substitute the given values into this formula to find the area.`;

        // Define the validate function
        const validateFn = (userInput) => {
          const isCorrect = parseFloat(userInput).toFixed(3) === answer.toFixed(3);
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, area.toFixed(3), validateFn, hint, false,
  "pvMuDPVOm7Y",
  "",);
      }

      //foobartrapezoid//
      function generateTrapezoidProblem() {
        const base1 = Math.floor(Math.random() * (10 - 5 + 1)) + 5; // Generates a random base length between 5 and 10
        const base2 = Math.floor(Math.random() * (15 - 10 + 1)) + 10; // Generates a random base length between 10 and 15
        const height = Math.floor(Math.random() * (8 - 4 + 1)) + 4; // Generates a random height between 4 and 8
        const area = ((base1 + base2) / 2) * height; // Formula for the area of a trapezoid

        document.getElementById('top-dimension').innerText = `${base1} units`;
        document.getElementById('bottom-dimension').innerText = `${base2} units`;
        document.getElementById('height-dimension').innerText = `${height} units`;

        adjustTrapezoidDimensions(base1, base2, height);
        // Assuming base1, base2, and height are displayed on the image through annotations or labels
        const question = `Given a trapezoid with bases of lengths ${base1} units and ${base2} units, and height of ${height} units, calculate the area of the trapezoid.`;
        const answer = ((base1 + base2) / 2) * height; // Formula for the area of a trapezoid
        const hint = `The formula for the area of a trapezoid is (base1 + base2) / 2 * height. Substitute the given values into this formula to find the area.`;



        // Define the validate function
        const validateFn = (userInput) => {
          const isCorrect = parseFloat(userInput).toFixed(3) === answer.toFixed(3);
          displayHintAndFeedback(isCorrect, hint);
          return isCorrect;
        };

        return new Problem(question, area.toFixed(3), validateFn, hint, false,
  "-_SIZw5H4dA",
  "",);
      }
      function adjustTrapezoidDimensions(base1, base2, height) {
        const trapezoid = document.querySelector('.trapezoid');

        if (!trapezoid) return;

        const baseDifference = Math.abs(base1 - base2);

        // Adjust the slants based on the base difference
        // Assuming the slant should be proportional to the height and the base difference
        const slantWidth = (baseDifference / 2); // This formula is adjustable based on your needs
        const bottomDimensionLabel = document.querySelector('.bottom-dimension');
        // Assuming 'height' is in pixels and you want to position the label slightly below the trapezoid
        const labelOffset = 30; // Extra space between the bottom of the trapezoid and the label
        bottomDimensionLabel.style.top = `${height + labelOffset}px`;

        // Adjust CSS properties
        trapezoid.style.borderBottomWidth = `${height*10}px`; //height of shape
        bottomDimensionLabel.style.top = `${height*10 + labelOffset}px`;
        trapezoid.style.width = `${base2*10}px`; // width of shape
        trapezoid.style.borderLeftWidth = `${slantWidth*10}px`; // Adjust based on a ratio or fixed value
        trapezoid.style.borderRightWidth = `${slantWidth*10}px`; // Adjust right border width for slant
        // Optionally adjust border-left and border-right if needed to represent the base lengths   border-left:
      }
      
      

      
      // sort function end

      function gcd(a, b) {
        if (!b) return a
        return gcd(b, a % b)
      }

      function lcm(a, b) {
        return Math.abs(a * b) / gcd(a, b)
      }

      function changeVideo(videoId) {
        const videoContainer = document.getElementById("videoContainer")
        if (videoContainer && videoId) {
          videoContainer.style.display = "block"
          videoContainer.innerHTML = `
      <iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    `
          document.getElementById("closeVideoButton").style.display =
            "inline-block"
        }
      }

      function closeVideo() {
        const videoContainer = document.getElementById("videoContainer")
        if (videoContainer) {
          videoContainer.style.display = "none"
          videoContainer.innerHTML = "" // Clear video content
        }
        document.getElementById("closeVideoButton").style.display = "none"
      }

      function displayHintAndFeedback(isCorrect, hint) {
    const hintElement = document.getElementById("hint");
    hintElement.style.display = isCorrect ? "none" : "block";
    hintElement.innerHTML = hint;

    // Retrieve both input values for logging
    const userAnswer = document.getElementById("userAnswer").value;
    const extraInput = document.getElementById("extraInput").value;

    if (isCorrect) {
        correctAnswers++; // Increment correct answers counter
    } else {
        incorrectAnswers++; // Increment incorrect answers counter
    }

    updateStorageWithProblemOutcome(isCorrect);

    // Log both inputs for debugging
    const logEntry = `<div class="${isCorrect ? "correct" : "incorrect"}">
    ${currentProblem.question} 
    Your answer: ${extraInput ? `Input 1= ${userAnswer}, Input 2= ${extraInput}` : `${userAnswer}`} - 
    ${isCorrect ? "Correct!" : "Incorrect"}
</div>`;

answersList = logEntry + answersList;
document.getElementById("previousAnswers").innerHTML = answersList;




    // Update the display of counters
    updateCountersDisplay();
}


      function updateStorageWithProblemOutcome(isCorrect) {
        const data = JSON.parse(localStorage.getItem("mathQuizData")) || {
          correct: 0,
          incorrect: 0,
          resetDate: getNextSunday(),
        }

        if (isCorrect) {
          data.correct += 1
        } else {
          data.incorrect += 1
        }

        // Check for weekly reset
        const currentDate = new Date()
        const resetDate = new Date(data.resetDate)
        if (currentDate >= resetDate) {
          data.correct = isCorrect ? 1 : 0
          data.incorrect = isCorrect ? 0 : 1
          data.resetDate = getNextSunday()
        }

        localStorage.setItem("mathQuizData", JSON.stringify(data))
      }

      function getNextSunday() {
        const today = new Date()
        const nextSunday = new Date()
        nextSunday.setDate(today.getDate() + (7 - today.getDay()))
        return nextSunday.toISOString().split("T")[0] // Returns date as "YYYY-MM-DD"
      }

      let currentProblem

      // Define an object mapping problem types to their generation functions

      let lastProblemType = "addition" // Initialize the last problem type

      function generateAndDisplayProblem(type = lastProblemType) {
        resetDefaultPlaceholders() // Reset placeholders to default
        // Show the input box by default
        document.getElementById("userAnswer").style.display = "block"
        // Hide all buttons by default
        const conditionalButtonsContainer =
          document.getElementById("conditionalButtons")
        conditionalButtonsContainer.style.display = "none"
        document.getElementById("lessThanButton").style.display = "none"
        document.getElementById("equalsButton").style.display = "none"
        document.getElementById("greaterThanButton").style.display = "none"
        document.getElementById("trueButton").style.display = "none"
        document.getElementById("falseButton").style.display = "none"

        const teachingVideoButton = document.getElementById(
          "teachingVideoButton",
        )
        const exampleVideoButton = document.getElementById("exampleVideoButton")

        // Hide video buttons by default
        teachingVideoButton.style.display = "none"
        exampleVideoButton.style.display = "none"

        const generatorData = problemGenerators[type]
        if (generatorData) {
          // Generate the problem
          currentProblem = generatorData.generate()

          // Display the question
          document.getElementById("problemContainer").innerHTML =
            currentProblem.question
          document.getElementById("userAnswer").value = ""
          document.getElementById("hint").style.display = "none"

          // Handle extra input box visibility
          const extraInput = document.getElementById("extraInput")
          if (currentProblem.needsExtraInput) {
            extraInput.style.display = "block"
          } else {
            extraInput.style.display = "none"
          }

          // Configure teaching video button if applicable
          if (currentProblem.teachingVideoId) {
            teachingVideoButton.style.display = "inline-block"
            teachingVideoButton.onclick = () =>
              changeVideo(currentProblem.teachingVideoId)
          }

          // Configure example video button if applicable
          if (currentProblem.exampleVideoId) {
            exampleVideoButton.style.display = "inline-block"
            exampleVideoButton.onclick = () =>
              changeVideo(currentProblem.exampleVideoId)
          }

          // Update last problem type
          lastProblemType = type
        } else {
          console.error(`Problem type "${type}" is not supported.`)
        }
      }

      function insertSymbol(symbol) {
        const userAnswer = document.getElementById("userAnswer")
        userAnswer.value = symbol // Insert the selected symbol into the input field

        // Automatically validate the answer
        validateAndProcessAnswer()
      }

      //foobartrapezoid//
      function toggleTrapezoidVisibility(isTrapezoidProblem) {
        const shapeContainer = document.querySelector(".shape-container")
        if (isTrapezoidProblem) {
          // Show the shape container for trapezoid problems
          shapeContainer.style.display = "block"
          // Call any functions needed to adjust the trapezoid dimensions here if necessary
        } else {
          // Hide the shape container for non-trapezoid problems
          shapeContainer.style.display = "none"
        }
      }

      document
        .getElementById("userAnswer")
        .addEventListener("keypress", function (event) {
          if (event.key === "Enter") {
            event.preventDefault()
            validateAndProcessAnswer()
          }
        })

      document
        .getElementById("extraInput")
        .addEventListener("keypress", function (event) {
          if (event.key === "Enter") {
            event.preventDefault()
            validateAndProcessAnswer()
          }
        })

      // Separate function to handle validation and problem generation
      function validateAndProcessAnswer() {
        const userInput = document.getElementById("userAnswer").value.trim()
        const extraUserInput = document
          .getElementById("extraInput")
          .value.trim()

        let combinedInput
        if (currentProblem.needsExtraInput) {
          combinedInput = `${userInput},${extraUserInput}`
        } else {
          combinedInput = userInput // Use only the main input
        }

        console.log("Combined Input:", combinedInput) // Log combined input for debugging
        const isCorrect = currentProblem.validate(combinedInput)

        // Clear the input fields
        document.getElementById("userAnswer").value = ""
        document.getElementById("extraInput").value = ""

        // Generate a new problem if the answer is correct
        if (isCorrect) {
          generateAndDisplayProblem(lastProblemType)
        }
      }

      document.addEventListener("click", function (event) {
        if (event.target.classList.contains("video-button")) {
          const videoId = event.target.dataset.videoId
          changeVideo(videoId)
        }
      })

      generateAndDisplayProblem("addition") // Initialize with an addition problem
      document
        .getElementById("smallFont")
        .addEventListener("click", function () {
          changeFontSize("small-font")
        })
      document
        .getElementById("mediumFont")
        .addEventListener("click", function () {
          changeFontSize("medium-font")
        })
      document
        .getElementById("largeFont")
        .addEventListener("click", function () {
          changeFontSize("large-font")
        })

      function resetDefaultPlaceholders() {
        document.getElementById("userAnswer").placeholder = "Enter your answer"
        document.getElementById("extraInput").style.display = "none"
        document.getElementById("extraInput").placeholder = "" // Clear the placeholder for extra input
      }

      function changeFontSize(sizeClass) {
        const problemContainer = document.getElementById("problemContainer")
        problemContainer.className = "" // Reset class
        problemContainer.classList.add(sizeClass)
      }

      updateCountersDisplay() // Initializes the display of counters when the page loads
    </script>
  </body>
</html>
